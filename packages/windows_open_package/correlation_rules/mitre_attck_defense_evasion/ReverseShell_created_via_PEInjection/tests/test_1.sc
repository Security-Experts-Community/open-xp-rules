{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"10\",\"Version\":\"3\",\"Level\":\"4\",\"Task\":\"10\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-07-03T20:39:30.2547335Z\"},\"EventRecordID\":\"8353\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"112\",\"ThreadID\":\"2084\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"IEWIN7\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2019-07-03 20:39:30.254\"},{\"Name\":\"SourceProcessGUID\",\"text\":\"{365abb72-1256-5d1d-0000-0010fb1a1b00}\"},{\"Name\":\"SourceProcessId\",\"text\":\"1632\"},{\"Name\":\"SourceThreadId\",\"text\":\"3148\"},{\"Name\":\"SourceImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\notepad.exe\"},{\"Name\":\"TargetProcessGUID\",\"text\":\"{365abb72-1282-5d1d-0000-0010dd401b00}\"},{\"Name\":\"TargetProcessId\",\"text\":\"2328\"},{\"Name\":\"TargetImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\rundll32.exe\"},{\"Name\":\"GrantedAccess\",\"text\":\"0x1fffff\"},{\"Name\":\"CallTrace\",\"text\":\"C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+4530c|C:\\\\Windows\\\\system32\\\\kernel32.dll+51133|C:\\\\Windows\\\\system32\\\\kernel32.dll+5cc37|C:\\\\Windows\\\\system32\\\\kernel32.dll+20ae|UNKNOWN(0053108F)|UNKNOWN(00531147)|UNKNOWN(0054001F)|C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+63618|C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+635eb\"}]}}}", "category.generic": "Process", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "3148", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+4530c|C:\\Windows\\system32\\kernel32.dll+51133|C:\\Windows\\system32\\kernel32.dll+5cc37|C:\\Windows\\system32\\kernel32.dll+20ae|UNKNOWN(0053108F)|UNKNOWN(00531147)|UNKNOWN(0054001F)|C:\\Windows\\SYSTEM32\\ntdll.dll+63618|C:\\Windows\\SYSTEM32\\ntdll.dll+635eb", "event_src.category": "Other", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_10_Process_access", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "10", "normalized": true, "object": "process", "object.process.fullpath": "c:\\windows\\system32\\rundll32.exe", "object.process.guid": "365abb72-1282-5d1d-0000-0010dd401b00", "object.process.id": "2328", "object.process.name": "rundll32.exe", "object.process.path": "c:\\windows\\system32\\", "object.property": "GrantedAccess", "object.value": "0x1fffff", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-06T15:52:44.702Z", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\windows\\system32\\notepad.exe", "subject.process.guid": "365abb72-1256-5d1d-0000-0010fb1a1b00", "subject.process.id": "1632", "subject.process.name": "notepad.exe", "subject.process.path": "c:\\windows\\system32\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-07-03T20:39:30.254Z", "type": "raw", "uuid": "e4b792cd-d9e2-4367-823e-f9405c1296c3"}
{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"1\",\"Version\":\"5\",\"Level\":\"4\",\"Task\":\"1\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-07-03T20:39:30.2547335Z\"},\"EventRecordID\":\"8352\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"112\",\"ThreadID\":\"2084\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"IEWIN7\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2019-07-03 20:39:30.254\"},{\"Name\":\"ProcessGuid\",\"text\":\"{365abb72-1282-5d1d-0000-0010dd401b00}\"},{\"Name\":\"ProcessId\",\"text\":\"2328\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Windows\\\\System32\\\\rundll32.exe\"},{\"Name\":\"FileVersion\",\"text\":\"6.1.7600.16385 (win7_rtm.090713-1255)\"},{\"Name\":\"Description\",\"text\":\"Windows host process (Rundll32)\"},{\"Name\":\"Product\",\"text\":\"Microsoft® Windows® Operating System\"},{\"Name\":\"Company\",\"text\":\"Microsoft Corporation\"},{\"Name\":\"CommandLine\",\"text\":\"rundll32.exe\"},{\"Name\":\"CurrentDirectory\",\"text\":\"C:\\\\Users\\\\IEUser\\\\\"},{\"Name\":\"User\",\"text\":\"IEWIN7\\\\IEUser\"},{\"Name\":\"LogonGuid\",\"text\":\"{365abb72-0a6f-5d1d-0000-0020ca350100}\"},{\"Name\":\"LogonId\",\"text\":\"0x135ca\"},{\"Name\":\"TerminalSessionId\",\"text\":\"1\"},{\"Name\":\"IntegrityLevel\",\"text\":\"Medium\"},{\"Name\":\"Hashes\",\"text\":\"SHA1=892503B20247B341CFD20DDA5FDACFA41527A087,MD5=C648901695E275C8F2AD04B687A68CE2,SHA256=3FA4912EB43FC304652D7B01F118589259861E2D628FA7C86193E54D5F987670,IMPHASH=239D911DFA7551A8B735680BC39B2238\"},{\"Name\":\"ParentProcessGuid\",\"text\":\"{365abb72-1256-5d1d-0000-0010fb1a1b00}\"},{\"Name\":\"ParentProcessId\",\"text\":\"1632\"},{\"Name\":\"ParentImage\",\"text\":\"C:\\\\Windows\\\\System32\\\\notepad.exe\"},{\"Name\":\"ParentCommandLine\",\"text\":\"\\\"C:\\\\Windows\\\\system32\\\\notepad.exe\\\"\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "datafield6": "365abb72-0a6f-5d1d-0000-0020ca350100", "event_src.category": "Other", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_1_Process_creation", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "1", "normalized": true, "object": "process", "object.account.domain": "iewin7", "object.account.id": "synthetic:ieuser@iewin7", "object.account.name": "ieuser", "object.account.privileges": "Medium", "object.account.session_id": "79306", "object.process.cmdline": "rundll32.exe", "object.process.cwd": "C:\\Users\\IEUser\\", "object.process.fullpath": "c:\\windows\\system32\\rundll32.exe", "object.process.guid": "365abb72-1282-5d1d-0000-0010dd401b00", "object.process.hash.imphash": "239D911DFA7551A8B735680BC39B2238", "object.process.hash.md5": "C648901695E275C8F2AD04B687A68CE2", "object.process.hash.sha1": "892503B20247B341CFD20DDA5FDACFA41527A087", "object.process.hash.sha256": "3FA4912EB43FC304652D7B01F118589259861E2D628FA7C86193E54D5F987670", "object.process.id": "2328", "object.process.meta": "Description:Windows host process (Rundll32) | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "rundll32.exe", "object.process.parent.cmdline": "\"C:\\Windows\\system32\\notepad.exe\"", "object.process.parent.fullpath": "c:\\windows\\system32\\notepad.exe", "object.process.parent.guid": "365abb72-1256-5d1d-0000-0010fb1a1b00", "object.process.parent.id": "1632", "object.process.parent.name": "notepad.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "6.1.7600.16385 (win7_rtm.090713-1255)", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-06T15:52:44.707Z", "status": "success", "subject": "account", "subject.account.domain": "iewin7", "subject.account.id": "synthetic:ieuser@iewin7", "subject.account.name": "ieuser", "subject.account.privileges": "Medium", "subject.account.session_id": "79306", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-07-03T20:39:30.254Z", "type": "raw", "uuid": "71d38006-b76d-499a-86a8-2c442e84fdbb"}
{"action": "detect", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"3\",\"Version\":\"5\",\"Level\":\"4\",\"Task\":\"3\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-07-03T20:39:31.7078585Z\"},\"EventRecordID\":\"8354\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"112\",\"ThreadID\":\"2096\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"IEWIN7\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2019-07-03 20:39:30.305\"},{\"Name\":\"ProcessGuid\",\"text\":\"{365abb72-1282-5d1d-0000-0010dd401b00}\"},{\"Name\":\"ProcessId\",\"text\":\"2328\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Windows\\\\System32\\\\rundll32.exe\"},{\"Name\":\"User\",\"text\":\"IEWIN7\\\\IEUser\"},{\"Name\":\"Protocol\",\"text\":\"tcp\"},{\"Name\":\"Initiated\",\"text\":\"true\"},{\"Name\":\"SourceIsIpv6\",\"text\":\"false\"},{\"Name\":\"SourceIp\",\"text\":\"10.0.2.13\"},{\"Name\":\"SourceHostname\",\"text\":\"IEWIN7\"},{\"Name\":\"SourcePort\",\"text\":\"49159\"},{\"Name\":\"SourcePortName\"},{\"Name\":\"DestinationIsIpv6\",\"text\":\"false\"},{\"Name\":\"DestinationIp\",\"text\":\"10.0.2.18\"},{\"Name\":\"DestinationHostname\"},{\"Name\":\"DestinationPort\",\"text\":\"8181\"},{\"Name\":\"DestinationPortName\"}]}}}", "category.generic": "Connection", "category.high": "Network Interaction Management", "category.low": "State", "direction": "egress", "dst.host": "10.0.2.18", "dst.ip": "10.0.2.18", "dst.port": 8181, "event_src.category": "Other", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_3_Network_connection", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "3", "normalized": true, "object": "connection", "object.account.domain": "iewin7", "object.account.id": "synthetic:ieuser@iewin7", "object.account.name": "ieuser", "object.process.fullpath": "c:\\windows\\system32\\rundll32.exe", "object.process.guid": "365abb72-1282-5d1d-0000-0010dd401b00", "object.process.id": "2328", "object.process.name": "rundll32.exe", "object.process.path": "c:\\windows\\system32\\", "protocol": "tcp", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-06T15:52:44.707Z", "src.host": "iewin7", "src.hostname": "iewin7", "src.ip": "10.0.2.13", "src.port": 49159, "status": "success", "subject": "rule", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-07-03T20:39:30.305Z", "type": "raw", "uuid": "9087bbc1-2e29-478a-b817-7046e83dfbf3"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 								{"action": "access", "category.generic": "Attack", "category.high": "Defense Evasion", "category.low": "Reflective Code Loading", "correlation_name": "ReverseShell_created_via_PEInjection", "correlation_type": "incident", "datafield5": "3148", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+4530c|C:\\Windows\\system32\\kernel32.dll+51133|C:\\Windows\\system32\\kernel32.dll+5cc37|C:\\Windows\\system32\\kernel32.dll+20ae|UNKNOWN(0053108F)|UNKNOWN(00531147)|UNKNOWN(0054001F)|C:\\Windows\\SYSTEM32\\ntdll.dll+63618|C:\\Windows\\SYSTEM32\\ntdll.dll+635eb", "direction": "egress", "dst.host": "10.0.2.18", "dst.ip": "10.0.2.18", "dst.port": 8181, "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "high", "incident.aggregation.key": "ReverseShell_created_via_PEInjection|iewin7|2328", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "object": "process", "object.account.domain": "iewin7", "object.account.id": "synthetic:ieuser@iewin7", "object.account.name": "ieuser", "object.account.session_id": "79306", "object.process.cmdline": "rundll32.exe", "object.process.cwd": "C:\\Users\\IEUser\\", "object.process.fullpath": "c:\\windows\\system32\\rundll32.exe", "object.process.hash.md5": "C648901695E275C8F2AD04B687A68CE2", "object.process.hash.sha1": "892503B20247B341CFD20DDA5FDACFA41527A087", "object.process.hash.sha256": "3FA4912EB43FC304652D7B01F118589259861E2D628FA7C86193E54D5F987670", "object.process.id": "2328", "object.process.meta": "Description:Windows host process (Rundll32) | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "rundll32.exe", "object.process.parent.cmdline": "\"C:\\Windows\\system32\\notepad.exe\"", "object.process.parent.fullpath": "c:\\windows\\system32\\notepad.exe", "object.process.parent.id": "1632", "object.process.parent.name": "notepad.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "6.1.7600.16385 (win7_rtm.090713-1255)", "object.property": "GrantedAccess", "object.value": "0x1fffff", "protocol": "tcp", "src.host": "iewin7", "src.hostname": "iewin7", "src.ip": "10.0.2.13", "src.port": 49159, "status": "success", "subject": "process", "subject.account.domain": "iewin7", "subject.account.id": "synthetic:ieuser@iewin7", "subject.account.name": "ieuser", "subject.account.privileges": "Medium", "subject.account.session_id": "79306"}
