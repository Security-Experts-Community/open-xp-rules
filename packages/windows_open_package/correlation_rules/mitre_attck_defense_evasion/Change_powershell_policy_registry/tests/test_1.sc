{"action": "modify", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"13\",\"Version\":\"2\",\"Level\":\"4\",\"Task\":\"13\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-05-24 15:38:21.485899\"},\"EventRecordID\":\"1387\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"220\",\"ThreadID\":\"2200\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"IEWIN7\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\",\"text\":\"Defense Evasion - PowerShell ExecPolicy Changed\"},{\"Name\":\"EventType\",\"text\":\"SetValue\"},{\"Name\":\"UtcTime\",\"text\":\"2019-05-24 15:38:21.365\"},{\"Name\":\"ProcessGuid\",\"text\":\"{365abb72-0fae-5ce8-0000-0010fe1e0800}\"},{\"Name\":\"ProcessId\",\"text\":\"3208\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"},{\"Name\":\"TargetObject\",\"text\":\"HKLM\\\\SOFTWARE\\\\Microsoft\\\\PowerShell\\\\1\\\\ShellIds\\\\Microsoft.PowerShell\\\\ExecutionPolicy\"},{\"Name\":\"Details\",\"text\":\"Unrestricted\"}]}}}", "category.generic": "Registry Object", "category.high": "System Management", "category.low": "Manipulation", "event_src.category": "Other", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.rule": "Defense Evasion - PowerShell ExecPolicy Changed", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_13_Registry_value_changed", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "13", "normalized": true, "object": "reg_object", "object.fullpath": "\\registry\\machine\\software\\microsoft\\powershell\\1\\shellids\\microsoft.powershell\\executionpolicy", "object.name": "executionpolicy", "object.new_value": "unrestricted", "object.path": "\\registry\\machine\\software\\microsoft\\powershell\\1\\shellids\\microsoft.powershell\\", "object.property": "value", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-10T16:50:46.783Z", "status": "success", "subject.process.fullpath": "c:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "subject.process.guid": "365abb72-0fae-5ce8-0000-0010fe1e0800", "subject.process.id": "3208", "subject.process.name": "powershell.exe", "subject.process.path": "c:\\windows\\system32\\windowspowershell\\v1.0\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-05-24T15:38:21.365Z", "type": "raw", "uuid": "036f8f61-521a-493a-8499-c6c5ebbf8ae7"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 								{"action": "modify", "alert.context": "powershell.exe: unrestricted -> \\registry\\machine\\software\\microsoft\\powershell\\1\\shellids\\microsoft.powershell\\executionpolicy", "alert.key": "unrestricted -> \\registry\\machine\\software\\microsoft\\powershell\\1\\shellids\\microsoft.powershell\\executionpolicy", "category.generic": "Attack", "category.high": "Defense Evasion", "category.low": "Modify Registry", "correlation_name": "Change_powershell_policy_registry", "correlation_type": "incident", "event_src.category": "Other", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.rule": "Defense Evasion - PowerShell ExecPolicy Changed", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "medium", "incident.aggregation.key": "Change_powershell_policy_registry|iewin7|powershell.exe", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "medium", "object": "reg_object", "object.fullpath": "\\registry\\machine\\software\\microsoft\\powershell\\1\\shellids\\microsoft.powershell\\executionpolicy", "object.name": "executionpolicy", "object.new_value": "unrestricted", "object.path": "\\registry\\machine\\software\\microsoft\\powershell\\1\\shellids\\microsoft.powershell\\", "object.property": "value", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "subject.process.guid": "365abb72-0fae-5ce8-0000-0010fe1e0800", "subject.process.id": "3208", "subject.process.name": "powershell.exe", "subject.process.path": "c:\\windows\\system32\\windowspowershell\\v1.0\\"}
