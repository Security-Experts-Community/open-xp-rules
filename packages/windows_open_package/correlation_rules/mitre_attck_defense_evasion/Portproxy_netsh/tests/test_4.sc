{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4688\",\"Version\":\"2\",\"Level\":\"0\",\"Task\":\"13312\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-06-03T09:35:26.1698588Z\"},\"EventRecordID\":\"97025\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"4\",\"ThreadID\":\"6900\"},\"Channel\":\"Security\",\"Computer\":\"pc1.lab.local\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-1840087645-2506612525-4240436938-1000\"},{\"Name\":\"SubjectUserName\",\"text\":\"admin\"},{\"Name\":\"SubjectDomainName\",\"text\":\"LAB\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x520de\"},{\"Name\":\"NewProcessId\",\"text\":\"0xd00\"},{\"Name\":\"NewProcessName\",\"text\":\"C:\\\\Windows\\\\System32\\\\netsh.exe\"},{\"Name\":\"TokenElevationType\",\"text\":\"%%1936\"},{\"Name\":\"ProcessId\",\"text\":\"0x8fc\"},{\"Name\":\"CommandLine\",\"text\":\"\\\"C:\\\\Windows\\\\system32\\\\netsh.exe\\\" interface port add v4 listenaddress=0.0.0.0 listenport=8882 connecta=0.0.0.0 connectp=3382\"},{\"Name\":\"TargetUserSid\",\"text\":\"S-1-0-0\"},{\"Name\":\"TargetUserName\",\"text\":\"-\"},{\"Name\":\"TargetDomainName\",\"text\":\"-\"},{\"Name\":\"TargetLogonId\",\"text\":\"0x0\"},{\"Name\":\"ParentProcessName\",\"text\":\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"},{\"Name\":\"MandatoryLabel\",\"text\":\"S-1-16-12288\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "event_src.category": "Operating system", "event_src.fqdn": "pc1.lab.local", "event_src.host": "pc1.lab.local", "event_src.hostname": "pc1", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4688_A_new_process_has_been_created", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4688", "normalized": true, "object": "process", "object.account.domain": "lab", "object.account.id": "S-1-5-21-1840087645-2506612525-4240436938-1000", "object.account.name": "admin", "object.account.session_id": "336094", "object.process.cmdline": "\"C:\\Windows\\system32\\netsh.exe\" interface port add v4 listenaddress=0.0.0.0 listenport=8882 connecta=0.0.0.0 connectp=3382", "object.process.fullpath": "c:\\windows\\system32\\netsh.exe", "object.process.id": "3328", "object.process.name": "netsh.exe", "object.process.parent.fullpath": "c:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "object.process.parent.id": "2300", "object.process.parent.name": "powershell.exe", "object.process.parent.path": "c:\\windows\\system32\\windowspowershell\\v1.0\\", "object.process.path": "c:\\windows\\system32\\", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-03T09:38:00.838Z", "status": "success", "subject": "account", "subject.account.domain": "lab", "subject.account.id": "S-1-5-21-1840087645-2506612525-4240436938-1000", "subject.account.name": "admin", "subject.account.privileges": "TokenElevationTypeDefault", "subject.account.session_id": "336094", "subject.state": "on behalf of oneself", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-06-03T09:35:26.169Z", "type": "raw", "uuid": "abdf4340-6eeb-450b-a57e-2851c16dc7fd"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 								{"action": "create", "alert.context": "lab\\admin \"C:\\Windows\\system32\\netsh.exe\" interface port add v4 listenaddress=0.0.0.0 listenport=8882 connecta=0.0.0.0 connectp=3382", "alert.key": "\"C:\\Windows\\system32\\netsh.exe\" interface port add v4 listenaddress=0.0.0.0 listenport=8882 connecta=0.0.0.0 connectp=3382", "category.generic": "Attack", "category.high": "Command and Control", "category.low": "Proxy", "correlation_name": "Portproxy_netsh", "correlation_type": "incident", "event_src.category": "Operating system", "event_src.host": "pc1.lab.local", "event_src.hostname": "pc1", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "importance": "medium", "incident.aggregation.key": "Portproxy_netsh|pc1.lab.local", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "medium", "object": "process", "object.account.domain": "lab", "object.account.id": "S-1-5-21-1840087645-2506612525-4240436938-1000", "object.account.name": "admin", "object.account.session_id": "336094", "object.process.cmdline": "\"C:\\Windows\\system32\\netsh.exe\" interface port add v4 listenaddress=0.0.0.0 listenport=8882 connecta=0.0.0.0 connectp=3382", "object.process.fullpath": "c:\\windows\\system32\\netsh.exe", "object.process.id": "3328", "object.process.name": "netsh.exe", "object.process.parent.fullpath": "c:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "object.process.parent.id": "2300", "object.process.parent.name": "powershell.exe", "object.process.parent.path": "c:\\windows\\system32\\windowspowershell\\v1.0\\", "object.process.path": "c:\\windows\\system32\\", "status": "success", "subject": "account", "subject.account.domain": "lab", "subject.account.id": "S-1-5-21-1840087645-2506612525-4240436938-1000", "subject.account.name": "admin", "subject.account.privileges": "TokenElevationTypeDefault", "subject.account.session_id": "336094"}
