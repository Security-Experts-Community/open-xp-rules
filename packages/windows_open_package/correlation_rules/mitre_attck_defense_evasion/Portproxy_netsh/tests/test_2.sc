{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"1\",\"Version\":\"5\",\"Level\":\"4\",\"Task\":\"1\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-05-23 17:46:04.671625\"},\"EventRecordID\":\"1026\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"2032\",\"ThreadID\":\"2092\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"IEWIN7\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2019-05-23 17:46:04.651\"},{\"Name\":\"ProcessGuid\",\"text\":\"{365abb72-dc5c-5ce6-0000-001066e27200}\"},{\"Name\":\"ProcessId\",\"text\":\"4088\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Windows\\\\System32\\\\netsh.exe\"},{\"Name\":\"FileVersion\",\"text\":\"6.1.7600.16385 (win7_rtm.090713-1255)\"},{\"Name\":\"Description\",\"text\":\"Network Command Shell\"},{\"Name\":\"Product\",\"text\":\"Microsoft&#174; Windows&#174; Operating System\"},{\"Name\":\"Company\",\"text\":\"Microsoft Corporation\"},{\"Name\":\"CommandLine\",\"text\":\"netsh  I p a v l=8001 listena=1.2.3.4 connectp=3389 c=1.2.3.5\"},{\"Name\":\"CurrentDirectory\",\"text\":\"c:\\\\\"},{\"Name\":\"User\",\"text\":\"IEWIN7\\\\IEUser\"},{\"Name\":\"LogonGuid\",\"text\":\"{365abb72-ce6c-5ce6-0000-002047f30000}\"},{\"Name\":\"LogonId\",\"text\":\"0x000000000000f347\"},{\"Name\":\"TerminalSessionId\",\"text\":\"1\"},{\"Name\":\"IntegrityLevel\",\"text\":\"High\"},{\"Name\":\"Hashes\",\"text\":\"SHA1=7DA1852DF83C58841AD35248AD2A20D7FFBB7FA0,MD5=784A50A6A09C25F011C3143DDD68E729,SHA256=661F5D4CE4F0A6CB32669A43CE5DEEC6D5A9E19B2387F22C5012405E92169943,IMPHASH=33B8120C37D7861778989FBFD16214E1\"},{\"Name\":\"ParentProcessGuid\",\"text\":\"{365abb72-dc3e-5ce6-0000-00102bc97200}\"},{\"Name\":\"ParentProcessId\",\"text\":\"712\"},{\"Name\":\"ParentImage\",\"text\":\"C:\\\\Windows\\\\System32\\\\cmd.exe\"},{\"Name\":\"ParentCommandLine\",\"text\":\"\\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\\"\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "datafield6": "365abb72-ce6c-5ce6-0000-002047f30000", "event_src.category": "Other", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_1_Process_creation", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "1", "normalized": true, "object": "process", "object.account.domain": "iewin7", "object.account.id": "synthetic:ieuser@iewin7", "object.account.name": "ieuser", "object.account.privileges": "High", "object.account.session_id": "62279", "object.process.cmdline": "netsh  I p a v l=8001 listena=1.2.3.4 connectp=3389 c=1.2.3.5", "object.process.cwd": "c:\\", "object.process.fullpath": "c:\\windows\\system32\\netsh.exe", "object.process.guid": "365abb72-dc5c-5ce6-0000-001066e27200", "object.process.hash.imphash": "33B8120C37D7861778989FBFD16214E1", "object.process.hash.md5": "784A50A6A09C25F011C3143DDD68E729", "object.process.hash.sha1": "7DA1852DF83C58841AD35248AD2A20D7FFBB7FA0", "object.process.hash.sha256": "661F5D4CE4F0A6CB32669A43CE5DEEC6D5A9E19B2387F22C5012405E92169943", "object.process.id": "4088", "object.process.meta": "Description:Network Command Shell | Product:Microsoft&#174; Windows&#174; Operating System | Company:Microsoft Corporation", "object.process.name": "netsh.exe", "object.process.parent.cmdline": "\"C:\\Windows\\system32\\cmd.exe\"", "object.process.parent.fullpath": "c:\\windows\\system32\\cmd.exe", "object.process.parent.guid": "365abb72-dc3e-5ce6-0000-00102bc97200", "object.process.parent.id": "712", "object.process.parent.name": "cmd.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "6.1.7600.16385 (win7_rtm.090713-1255)", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-03T10:10:15.193Z", "status": "success", "subject": "account", "subject.account.domain": "iewin7", "subject.account.id": "synthetic:ieuser@iewin7", "subject.account.name": "ieuser", "subject.account.privileges": "High", "subject.account.session_id": "62279", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-05-23T17:46:04.651Z", "type": "raw", "uuid": "a74d0b25-16d5-4ed0-aea1-cfed8b6da080"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"action": "create", "alert.context": "iewin7\\ieuser netsh  I p a v l=8001 listena=1.2.3.4 connectp=3389 c=1.2.3.5", "alert.key": "netsh  I p a v l=8001 listena=1.2.3.4 connectp=3389 c=1.2.3.5", "category.generic": "Attack", "category.high": "Command and Control", "category.low": "Proxy", "correlation_name": "Portproxy_netsh", "correlation_type": "incident", "datafield6": "365abb72-ce6c-5ce6-0000-002047f30000", "event_src.category": "Other", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "medium", "incident.aggregation.key": "Portproxy_netsh|iewin7", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "medium", "object": "process", "object.account.domain": "iewin7", "object.account.id": "synthetic:ieuser@iewin7", "object.account.name": "ieuser", "object.account.privileges": "High", "object.account.session_id": "62279", "object.process.cmdline": "netsh  I p a v l=8001 listena=1.2.3.4 connectp=3389 c=1.2.3.5", "object.process.cwd": "c:\\", "object.process.fullpath": "c:\\windows\\system32\\netsh.exe", "object.process.guid": "365abb72-dc5c-5ce6-0000-001066e27200", "object.process.hash.md5": "784A50A6A09C25F011C3143DDD68E729", "object.process.hash.sha1": "7DA1852DF83C58841AD35248AD2A20D7FFBB7FA0", "object.process.hash.sha256": "661F5D4CE4F0A6CB32669A43CE5DEEC6D5A9E19B2387F22C5012405E92169943", "object.process.id": "4088", "object.process.meta": "Description:Network Command Shell | Product:Microsoft&#174; Windows&#174; Operating System | Company:Microsoft Corporation", "object.process.name": "netsh.exe", "object.process.parent.cmdline": "\"C:\\Windows\\system32\\cmd.exe\"", "object.process.parent.fullpath": "c:\\windows\\system32\\cmd.exe", "object.process.parent.id": "712", "object.process.parent.name": "cmd.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "6.1.7600.16385 (win7_rtm.090713-1255)", "status": "success", "subject": "account", "subject.account.domain": "iewin7", "subject.account.id": "synthetic:ieuser@iewin7", "subject.account.name": "ieuser", "subject.account.privileges": "High", "subject.account.session_id": "62279"}
