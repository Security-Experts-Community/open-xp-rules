{"action": "execute", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"MSSQLSERVER\"},\"EventID\":{\"text\":\"33205\",\"Qualifiers\":\"16384\"},\"Level\":\"0\",\"Task\":\"5\",\"Keywords\":\"0xa0000000000000\",\"TimeCreated\":{\"SystemTime\":\"2020-01-31T14:18:25.292649100Z\"},\"EventRecordID\":\"1894\",\"Channel\":\"Application\",\"Computer\":\"DESKTOP-GB13G7P\",\"Security\":null},\"EventData\":{\"Data\":\"audit_schema_version:1\\nevent_time:2020-01-31 14:18:24.2931884\\nsequence_number:1\\naction_id:EX \\nsucceeded:true\\nis_column_permission:false\\nsession_id:57\\nserver_principal_id:268\\ndatabase_principal_id:1\\ntarget_server_principal_id:0\\ntarget_database_principal_id:0\\nobject_id:-1008137134\\nuser_defined_event_id:0\\ntransaction_id:54619\\nclass_type:X \\npermission_bitmask:00000000000000000000000000000020\\nsequence_group_id:855307DD-33F9-4781-BC23-94C72CCD8460\\nsession_server_principal_name:Analysis\\nserver_principal_name:Analysis\\nserver_principal_sid:5c9dc62711b2c84695fc5132e3a852db\\ndatabase_principal_name:dbo\\ntarget_server_principal_name:\\ntarget_server_principal_sid:\\ntarget_database_principal_name:\\nserver_instance_name:DESKTOP-GB13G7P\\ndatabase_name:master\\nschema_name:sys\\nobject_name:xp_cmdshell\\nstatement:EXEC xp_cmdshell 'ipconfig'\\nadditional_information:\\nuser_defined_information:\\n\"}}}", "datafield1": "EXEC xp_cmdshell 'ipconfig'", "datafield2": "DESKTOP-GB13G7P", "datafield3": "master", "datafield4": "EX", "datafield5": "X", "datafield8": "ipconfig", "event_src.category": "Database server", "event_src.fqdn": "desktop-gb13g7p", "event_src.host": "desktop-gb13g7p", "event_src.hostname": "desktop-gb13g7p", "event_src.subsys": "Application", "event_src.title": "sql_server", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_SQL_Server_eventlog_33205_audit_exec_used", "importance": "high", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "33205", "normalized": true, "object": "command", "object.property": "command name", "object.query": "EXEC xp_cmdshell 'ipconfig'", "object.type": "commandline payload", "object.value": "xp_cmdshell", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-05T12:18:11.012Z", "status": "success", "subject": "account", "subject.account.id": "5c9dc62711b2c84695fc5132e3a852db", "subject.account.name": "analysis", "subject.id": "5c9dc62711b2c84695fc5132e3a852db", "subject.name": "analysis", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2020-01-31T14:18:24.293Z", "type": "raw", "uuid": "558a6586-c704-44f4-a03e-e4cdb5321652"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"action": "execute", "alert.context": "ipconfig", "alert.key": "EXEC xp_cmdshell 'ipconfig'", "category.generic": "Attack", "category.high": "Execution", "category.low": "Command-Line Interface", "correlation_name": "XP_Cmdshell_Usage", "correlation_type": "event", "datafield1": "EXEC xp_cmdshell 'ipconfig'", "datafield2": "DESKTOP-GB13G7P", "datafield3": "master", "datafield4": "EX", "datafield5": "X", "datafield8": "ipconfig", "event_src.category": "Database server", "event_src.fqdn": "desktop-gb13g7p", "event_src.host": "desktop-gb13g7p", "event_src.hostname": "desktop-gb13g7p", "event_src.subsys": "Application", "event_src.title": "sql_server", "event_src.vendor": "microsoft", "importance": "high", "incident.aggregation.key": "XP_Cmdshell_Usage|desktop-gb13g7p|5c9dc62711b2c84695fc5132e3a852db", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "object": "command", "object.property": "command name", "object.query": "EXEC xp_cmdshell 'ipconfig'", "object.type": "commandline payload", "object.value": "xp_cmdshell", "status": "success", "subject": "account", "subject.account.id": "5c9dc62711b2c84695fc5132e3a852db", "subject.account.name": "analysis"}
