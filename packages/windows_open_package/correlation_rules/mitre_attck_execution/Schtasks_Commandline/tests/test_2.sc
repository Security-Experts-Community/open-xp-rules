{"action": "execute", "body": "{ \"Event\": { \"xmlns\": \"http://schemas.microsoft.com/win/2004/08/events/event\", \"System\": { \"Provider\": { \"Name\": \"Microsoft-Windows-PowerShell\", \"Guid\": \"{a0c1853b-5c40-4b15-8766-3cf1c58f985a}\" }, \"EventID\": \"4104\", \"Version\": \"1\", \"Level\": \"5\", \"Task\": \"2\", \"Opcode\": \"15\", \"Keywords\": \"0x0\", \"TimeCreated\": { \"SystemTime\": \"2021-08-16T13:16:24.2372357Z\" }, \"EventRecordID\": \"661762\", \"Correlation\": { \"ActivityID\": \"{a5f1f89b-9179-0005-5b0c-f3a57991d701}\" }, \"Execution\": { \"ProcessID\": \"7148\", \"ThreadID\": \"5328\" }, \"Channel\": \"Microsoft-Windows-PowerShell/Operational\", \"Computer\": \"Test_w10x64-130.testlab.org\", \"Security\": { \"UserID\": \"S-1-5-21-1129291328-2819992169-918366777-1113\" } }, \"EventData\": { \"Data\": [ { \"text\": \"1\", \"Name\": \"MessageNumber\" }, { \"text\": \"1\", \"Name\": \"MessageTotal\" }, { \"text\": \"schtasks.exe -create -tn \\\"test\\\" /sc Onstart \", \"Name\": \"ScriptBlockText\" }, { \"text\": \"3f1bc101-7f89-45b1-b934-0843b62a022c\", \"Name\": \"ScriptBlockId\" }, { \"Name\": \"Path\" } ] }, \"RenderingInfo\": { \"Culture\": \"en-US\", \"Message\": \"Creating Scriptblock text (1 of 1):\\r\\nschtasks.exe -create -tn \\\"test\\\" /sc Onstart \\r\\n\\r\\nScriptBlock ID: 3f1bc101-7f89-45b1-b934-0843b62a022c\\r\\nPath: \", \"Level\": \"Verbose\", \"Task\": \"Execute a Remote Command\", \"Opcode\": \"On create calls\", \"Channel\": \"Microsoft-Windows-PowerShell/Operational\", \"Provider\": null, \"Keywords\": null } } }", "category.generic": "Command", "category.high": "System Management", "category.low": "Manipulation", "event_src.category": "Operating system", "event_src.fqdn": "test_w10x64-130.testlab.org", "event_src.host": "test_w10x64-130.testlab.org", "event_src.hostname": "test_w10x64-130", "event_src.subsys": "Microsoft-Windows-PowerShell/Operational", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Common_PowerShell_4104_Command_executed", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4104", "normalized": true, "numfield1": 1, "numfield2": 1, "object": "command", "object.account.id": "S-1-5-21-1129291328-2819992169-918366777-1113", "object.id": "3f1bc101-7f89-45b1-b934-0843b62a022c", "object.process.cmdline": "schtasks.exe -create -tn \"test\" /sc Onstart", "object.process.id": "7148", "object.value": "schtasks.exe -create -tn \"test\" /sc Onstart", "recv_ipv4": "127.0.0.1", "recv_time": "2021-08-16T16:44:55Z", "status": "success", "subject": "account", "subject.account.id": "S-1-5-21-1129291328-2819992169-918366777-1113", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-08-16T13:16:24.237Z", "type": "raw", "uuid": "81abeb5a-6639-49fe-b87a-58050f411983"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 								{"action": "create", "alert.context": "create the task: test|regex_match: schtasks.exe -create", "alert.key": "schtasks.exe -create -tn \"test\" /sc onstart", "category.generic": "Attack", "category.high": "Execution", "category.low": "Scheduled Task", "correlation_name": "Schtasks_Commandline", "correlation_type": "event", "event_src.category": "Operating system", "event_src.fqdn": "test_w10x64-130.testlab.org", "event_src.host": "test_w10x64-130.testlab.org", "event_src.hostname": "test_w10x64-130", "event_src.subsys": "Microsoft-Windows-PowerShell/Operational", "event_src.title": "windows", "event_src.vendor": "microsoft", "importance": "high", "incident.aggregation.key": "Schtasks_Commandline|test_w10x64-130.testlab.org|S-1-5-21-1129291328-2819992169-918366777-1113||create", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "object": "command", "object.account.id": "S-1-5-21-1129291328-2819992169-918366777-1113", "object.id": "3f1bc101-7f89-45b1-b934-0843b62a022c", "object.name": "test", "object.process.cmdline": "schtasks.exe -create -tn \"test\" /sc Onstart", "object.process.id": "7148", "object.value": "schtasks.exe -create -tn \"test\" /sc Onstart", "status": "success", "subject": "account", "subject.account.id": "S-1-5-21-1129291328-2819992169-918366777-1113"}
							
