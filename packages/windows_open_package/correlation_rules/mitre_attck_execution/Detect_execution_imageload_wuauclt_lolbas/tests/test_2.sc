{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"1\",\"Version\":\"5\",\"Level\":\"4\",\"Task\":\"1\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2020-10-13T20:11:42.2786722Z\"},\"EventRecordID\":\"2196442\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"5340\",\"ThreadID\":\"7092\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"LAPTOP-JU4M3I0E\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2020-10-13 20:11:42.277\"},{\"Name\":\"ProcessGuid\",\"text\":\"{00247c92-09fe-5f86-0000-0010ac861401}\"},{\"Name\":\"ProcessId\",\"text\":\"6372\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Windows\\\\System32\\\\cmd.exe\"},{\"Name\":\"FileVersion\",\"text\":\"10.0.18362.449 (WinBuild.160101.0800)\"},{\"Name\":\"Description\",\"text\":\"Windows Command Processor\"},{\"Name\":\"Product\",\"text\":\"Microsoft® Windows® Operating System\"},{\"Name\":\"Company\",\"text\":\"Microsoft Corporation\"},{\"Name\":\"OriginalFileName\",\"text\":\"Cmd.Exe\"},{\"Name\":\"CommandLine\",\"text\":\"c:\\\\windows\\\\system32\\\\cmd.exe\"},{\"Name\":\"CurrentDirectory\",\"text\":\"c:\\\\Windows\\\\System32\\\\\"},{\"Name\":\"User\",\"text\":\"LAPTOP-JU4M3I0E\\\\bouss\"},{\"Name\":\"LogonGuid\",\"text\":\"{00247c92-de70-5f85-0000-002059f80600}\"},{\"Name\":\"LogonId\",\"text\":\"0x6f859\"},{\"Name\":\"TerminalSessionId\",\"text\":\"1\"},{\"Name\":\"IntegrityLevel\",\"text\":\"Medium\"},{\"Name\":\"Hashes\",\"text\":\"SHA1=8DCA9749CD48D286950E7A9FA1088C937CBCCAD4,MD5=D7AB69FAD18D4A643D84A271DFC0DBDF,SHA256=FF79D3C4A0B7EB191783C323AB8363EBD1FD10BE58D8BCC96B07067743CA81D5,IMPHASH=272245E2988E1E430500B852C4FB5E18\"},{\"Name\":\"ParentProcessGuid\",\"text\":\"{00247c92-09fe-5f86-0000-001051841401}\"},{\"Name\":\"ParentProcessId\",\"text\":\"1716\"},{\"Name\":\"ParentImage\",\"text\":\"C:\\\\Windows\\\\System32\\\\wuauclt.exe\"},{\"Name\":\"ParentCommandLine\",\"text\":\"wuauclt.exe /UpdateDeploymentProvider C:\\\\ProgramData\\\\Intel\\\\helpa.dll /RunHandlerComServer\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "datafield6": "00247c92-de70-5f85-0000-002059f80600", "event_src.category": "Other", "event_src.fqdn": "laptop-ju4m3i0e", "event_src.host": "laptop-ju4m3i0e", "event_src.hostname": "laptop-ju4m3i0e", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_1_Process_creation", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "1", "normalized": true, "object": "process", "object.account.domain": "laptop-ju4m3i0e", "object.account.id": "synthetic:bouss@laptop-ju4m3i0e", "object.account.name": "bouss", "object.account.privileges": "Medium", "object.account.session_id": "456793", "object.process.cmdline": "c:\\windows\\system32\\cmd.exe", "object.process.cwd": "c:\\Windows\\System32\\", "object.process.fullpath": "c:\\windows\\system32\\cmd.exe", "object.process.guid": "00247c92-09fe-5f86-0000-0010ac861401", "object.process.hash.imphash": "272245E2988E1E430500B852C4FB5E18", "object.process.hash.md5": "D7AB69FAD18D4A643D84A271DFC0DBDF", "object.process.hash.sha1": "8DCA9749CD48D286950E7A9FA1088C937CBCCAD4", "object.process.hash.sha256": "FF79D3C4A0B7EB191783C323AB8363EBD1FD10BE58D8BCC96B07067743CA81D5", "object.process.id": "6372", "object.process.meta": "Description:Windows Command Processor | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "cmd.exe", "object.process.original_name": "Cmd.Exe", "object.process.parent.cmdline": "wuauclt.exe /UpdateDeploymentProvider C:\\ProgramData\\Intel\\helpa.dll /RunHandlerComServer", "object.process.parent.fullpath": "c:\\windows\\system32\\wuauclt.exe", "object.process.parent.guid": "00247c92-09fe-5f86-0000-001051841401", "object.process.parent.id": "1716", "object.process.parent.name": "wuauclt.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "10.0.18362.449 (WinBuild.160101.0800)", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-12T13:57:45.354Z", "status": "success", "subject": "account", "subject.account.domain": "laptop-ju4m3i0e", "subject.account.id": "synthetic:bouss@laptop-ju4m3i0e", "subject.account.name": "bouss", "subject.account.privileges": "Medium", "subject.account.session_id": "456793", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2020-10-13T20:11:42.277Z", "type": "raw", "uuid": "63b9ed71-a0a7-4346-b8d1-40318fab1353"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"action": "start", "alert.key": "wuauclt.exe /updatedeploymentprovider c:\\programdata\\intel\\helpa.dll /runhandlercomserver", "category.generic": "Attack", "category.high": "Execution", "category.low": "System Binary Proxy Execution", "correlation_name": "Detect_execution_imageload_wuauclt_lolbas", "correlation_type": "incident", "datafield6": "00247c92-de70-5f85-0000-002059f80600", "event_src.category": "Other", "event_src.fqdn": "laptop-ju4m3i0e", "event_src.host": "laptop-ju4m3i0e", "event_src.hostname": "laptop-ju4m3i0e", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "correlationengine", "importance": "high", "incident.aggregation.key": "Detect_execution_imageload_wuauclt_lolbas|laptop-ju4m3i0e|wuauclt.exe /UpdateDeploymentProvider C:\\ProgramData\\Intel\\helpa.dll /RunHandlerComServer|c:\\windows\\system32\\cmd.exe", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "object": "process", "object.account.domain": "laptop-ju4m3i0e", "object.account.id": "synthetic:bouss@laptop-ju4m3i0e", "object.account.name": "bouss", "object.account.session_id": "456793", "object.process.cmdline": "c:\\windows\\system32\\cmd.exe", "object.process.cwd": "c:\\Windows\\System32\\", "object.process.fullpath": "c:\\windows\\system32\\cmd.exe", "object.process.guid": "00247c92-09fe-5f86-0000-0010ac861401", "object.process.id": "6372", "object.process.meta": "Description:Windows Command Processor | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "cmd.exe", "object.process.original_name": "Cmd.Exe", "object.process.parent.cmdline": "wuauclt.exe /UpdateDeploymentProvider C:\\ProgramData\\Intel\\helpa.dll /RunHandlerComServer", "object.process.parent.fullpath": "c:\\windows\\system32\\wuauclt.exe", "object.process.parent.guid": "00247c92-09fe-5f86-0000-001051841401", "object.process.parent.id": "1716", "object.process.parent.name": "wuauclt.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "10.0.18362.449 (WinBuild.160101.0800)", "status": "success", "subject": "account", "subject.account.domain": "laptop-ju4m3i0e", "subject.account.id": "synthetic:bouss@laptop-ju4m3i0e", "subject.account.name": "bouss", "subject.account.privileges": "Medium", "subject.account.session_id": "456793"}