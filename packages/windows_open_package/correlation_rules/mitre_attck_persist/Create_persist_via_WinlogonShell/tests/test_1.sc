{"action": "modify", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"13\",\"Version\":\"2\",\"Level\":\"4\",\"Task\":\"13\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-06-14T22:22:21.5352457Z\"},\"EventRecordID\":\"7532\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"1960\",\"ThreadID\":\"288\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"IEWIN7\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\",\"text\":\"Persistence - Winlogon Shell\"},{\"Name\":\"EventType\",\"text\":\"SetValue\"},{\"Name\":\"UtcTime\",\"text\":\"2019-06-14 22:22:21.519\"},{\"Name\":\"ProcessGuid\",\"text\":\"{365abb72-1e19-5d04-0000-0010dfc60a00}\"},{\"Name\":\"ProcessId\",\"text\":\"4020\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Users\\\\IEUser\\\\Downloads\\\\a.exe\"},{\"Name\":\"TargetObject\",\"text\":\"HKU\\\\S-1-5-21-3583694148-1414552638-2922671848-1000\\\\Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Shell\"},{\"Name\":\"Details\",\"text\":\"\\\"C:\\\\Users\\\\IEUser\\\\AppData\\\\Roaming\\\\9QxTsAU9w8gyPj4w\\\\BRE6BgE2JubB.exe\\\",explorer.exe\"}]}}}", "category.generic": "Registry Object", "category.high": "System Management", "category.low": "Manipulation", "event_src.category": "Other", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.rule": "Persistence - Winlogon Shell", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_13_Registry_value_changed", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "13", "normalized": true, "object": "reg_object", "object.fullpath": "\\registry\\user\\s-1-5-21-3583694148-1414552638-2922671848-1000\\software\\microsoft\\windows nt\\currentversion\\winlogon\\shell", "object.name": "shell", "object.new_value": "\"c:\\users\\ieuser\\appdata\\roaming\\9qxtsau9w8gypj4w\\bre6bge2jubb.exe\",explorer.exe", "object.path": "\\registry\\user\\s-1-5-21-3583694148-1414552638-2922671848-1000\\software\\microsoft\\windows nt\\currentversion\\winlogon\\", "object.property": "value", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-02T11:42:28.474Z", "status": "success", "subject.process.fullpath": "c:\\users\\ieuser\\downloads\\a.exe", "subject.process.guid": "365abb72-1e19-5d04-0000-0010dfc60a00", "subject.process.id": "4020", "subject.process.name": "a.exe", "subject.process.path": "c:\\users\\ieuser\\downloads\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-06-14T22:22:21.519Z", "type": "raw", "uuid": "6e66670d-b0b9-4457-8552-6bebc5dfcfbf"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"action": "modify", "category.generic": "Persistence", "category.high": "Boot or Logon Autostart Execution", "category.low": "Winlogon Helper DLL", "correlation_name": "Create_persist_via_WinlogonShell", "correlation_type": "incident", "event_src.category": "Other", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.rule": "Persistence - Winlogon Shell", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "medium", "incident.aggregation.key": "Create_persist_via_WinlogonShell|iewin7|a.exe", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "medium", "object": "reg_object", "object.fullpath": "\\registry\\user\\s-1-5-21-3583694148-1414552638-2922671848-1000\\software\\microsoft\\windows nt\\currentversion\\winlogon\\shell", "object.name": "shell", "object.new_value": "\"c:\\users\\ieuser\\appdata\\roaming\\9qxtsau9w8gypj4w\\bre6bge2jubb.exe\",explorer.exe", "object.path": "\\registry\\user\\s-1-5-21-3583694148-1414552638-2922671848-1000\\software\\microsoft\\windows nt\\currentversion\\winlogon\\", "object.property": "value", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\users\\ieuser\\downloads\\a.exe", "subject.process.id": "4020", "subject.process.name": "a.exe", "subject.process.path": "c:\\users\\ieuser\\downloads\\"}
