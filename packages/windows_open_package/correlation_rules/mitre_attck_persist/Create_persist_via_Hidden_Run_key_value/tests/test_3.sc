{"action": "modify", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4657\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12801\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-06-12T18:38:16.4541169Z\"},\"EventRecordID\":\"27723336\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"4\",\"ThreadID\":\"12384\"},\"Channel\":\"Security\",\"Computer\":\"win10-work.stand2008.local\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-3800063338-4262557262-2801230003-500\"},{\"Name\":\"SubjectUserName\",\"text\":\"Администратор\"},{\"Name\":\"SubjectDomainName\",\"text\":\"STAND2008\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x4c7672\"},{\"Name\":\"ObjectName\",\"text\":\"\\\\REGISTRY\\\\USER\\\\S-1-5-21-3800063338-4262557262-2801230003-500\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"},{\"Name\":\"ObjectValueName\"},{\"Name\":\"HandleId\",\"text\":\"0x46004f00530000\"},{\"Name\":\"OperationType\",\"text\":\"TWARE\\\\\"},{\"Name\":\"OldValueType\",\"text\":\"°\"},{\"Name\":\"OldValue\"},{\"Name\":\"NewValueType\"},{\"Name\":\"NewValue\",\"text\":\"%%1904\"},{\"Name\":\"ProcessId\",\"text\":\"0x2d0000002d\"},{\"Name\":\"ProcessName\",\"text\":\"%%1873\"}]}}}", "category.generic": "Registry Object", "category.high": "System Management", "category.low": "Manipulation", "event_src.category": "Operating system", "event_src.fqdn": "win10-work.stand2008.local", "event_src.host": "win10-work.stand2008.local", "event_src.hostname": "win10-work", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4657_Registry_value_changed", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4657", "normalized": true, "object": "reg_object", "object.fullpath": "\\registry\\user\\s-1-5-21-3800063338-4262557262-2801230003-500\\software\\microsoft\\windows\\currentversion\\run\\", "object.new_value": "%%1904", "object.path": "\\registry\\user\\s-1-5-21-3800063338-4262557262-2801230003-500\\software\\microsoft\\windows\\currentversion\\run", "object.property": "value", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-12T19:31:34.631Z", "status": "success", "subject": "account", "subject.account.domain": "stand2008", "subject.account.id": "S-1-5-21-3800063338-4262557262-2801230003-500", "subject.account.name": "администратор", "subject.account.session_id": "5011058", "subject.process.fullpath": "%%1873", "subject.process.name": "%%1873", "subject.process.path": "", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-06-12T18:38:16.454Z", "type": "raw", "uuid": "fcb41669-3b01-4f60-ac0c-e7e34b38d3b1"}
{"action": "modify", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4657\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12801\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-06-12T18:39:17.9066951Z\"},\"EventRecordID\":\"27724621\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"4\",\"ThreadID\":\"5664\"},\"Channel\":\"Security\",\"Computer\":\"win10-work.stand2008.local\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-3800063338-4262557262-2801230003-500\"},{\"Name\":\"SubjectUserName\",\"text\":\"Администратор\"},{\"Name\":\"SubjectDomainName\",\"text\":\"STAND2008\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x4c7672\"},{\"Name\":\"ObjectName\",\"text\":\"\\\\REGISTRY\\\\USER\\\\S-1-5-21-3800063338-4262557262-2801230003-500\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"},{\"Name\":\"ObjectValueName\"},{\"Name\":\"HandleId\",\"text\":\"0x46004f00530000\"},{\"Name\":\"OperationType\",\"text\":\"TWARE\\\\\"},{\"Name\":\"OldValueType\",\"text\":\"°\"},{\"Name\":\"OldValue\"},{\"Name\":\"NewValueType\"},{\"Name\":\"NewValue\",\"text\":\"%%1906\"},{\"Name\":\"ProcessId\",\"text\":\"0x38003100250025\"},{\"Name\":\"ProcessName\",\"text\":\"73\"}]}}}", "category.generic": "Registry Object", "category.high": "System Management", "category.low": "Manipulation", "event_src.category": "Operating system", "event_src.fqdn": "win10-work.stand2008.local", "event_src.host": "win10-work.stand2008.local", "event_src.hostname": "win10-work", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4657_Registry_value_changed", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4657", "normalized": true, "object": "reg_object", "object.fullpath": "\\registry\\user\\s-1-5-21-3800063338-4262557262-2801230003-500\\software\\microsoft\\windows\\currentversion\\run\\", "object.new_value": "%%1906", "object.path": "\\registry\\user\\s-1-5-21-3800063338-4262557262-2801230003-500\\software\\microsoft\\windows\\currentversion\\run", "object.property": "value", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-12T19:31:34.632Z", "status": "success", "subject": "account", "subject.account.domain": "stand2008", "subject.account.id": "S-1-5-21-3800063338-4262557262-2801230003-500", "subject.account.name": "администратор", "subject.account.session_id": "5011058", "subject.process.fullpath": "73", "subject.process.name": "73", "subject.process.path": "", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-06-12T18:39:17.906Z", "type": "raw", "uuid": "c955449d-632d-4905-b52c-d69e843f8371"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 								{"action": "modify", "category.generic": "Attack", "category.high": "Persistence", "category.low": "Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder", "correlation_name": "Create_persist_via_Hidden_Run_key_value", "correlation_type": "incident", "event_src.category": "Operating system", "event_src.fqdn": "win10-work.stand2008.local", "event_src.host": "win10-work.stand2008.local", "event_src.hostname": "win10-work", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "importance": "medium", "incident.aggregation.key": "Create_persist_via_Hidden_Run_key_value|win10-work.stand2008.local|%%1873", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "medium", "object": "reg_object", "object.fullpath": "\\registry\\user\\s-1-5-21-3800063338-4262557262-2801230003-500\\software\\microsoft\\windows\\currentversion\\run\\", "object.new_value": "%%1904", "object.path": "\\registry\\user\\s-1-5-21-3800063338-4262557262-2801230003-500\\software\\microsoft\\windows\\currentversion\\run", "object.property": "value", "status": "success", "subject": "account", "subject.account.domain": "stand2008", "subject.account.id": "S-1-5-21-3800063338-4262557262-2801230003-500", "subject.account.name": "администратор", "subject.account.session_id": "5011058", "subject.process.fullpath": "%%1873", "subject.process.name": "%%1873", "subject.process.path": ""}
