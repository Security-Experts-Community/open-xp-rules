# Здесь укажи какие нормализованные события (одно или несколько) ты подаёшь на вход правилу корреляции.
# События отделяются друг от друга символом новой строки. Каждое их них должно быть записано в строку.
{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"10\",\"Version\":\"3\",\"Level\":\"4\",\"Task\":\"10\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2020-07-07T21:51:39.2628628Z\"},\"EventRecordID\":\"2125129\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"5320\",\"ThreadID\":\"6908\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"LAPTOP-JU4M3I0E\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2020-07-07 21:51:39.262\"},{\"Name\":\"SourceProcessGUID\",\"text\":\"{00247c92-ee6b-5f04-0000-00109069a859}\"},{\"Name\":\"SourceProcessId\",\"text\":\"28528\"},{\"Name\":\"SourceThreadId\",\"text\":\"22356\"},{\"Name\":\"SourceImage\",\"text\":\"C:\\\\Users\\\\Public\\\\tools\\\\SysinternalsSuite\\\\procdump64.exe\"},{\"Name\":\"TargetProcessGUID\",\"text\":\"{00247c92-ee6b-5f04-0000-00105c6ca859}\"},{\"Name\":\"TargetProcessId\",\"text\":\"30096\"},{\"Name\":\"TargetImage\",\"text\":\"C:\\\\windows\\\\system32\\\\lsass.exe\"},{\"Name\":\"GrantedAccess\",\"text\":\"0x1fffff\"},{\"Name\":\"CallTrace\",\"text\":\"C:\\\\windows\\\\SYSTEM32\\\\ntdll.dll+9ca14|C:\\\\windows\\\\SYSTEM32\\\\ntdll.dll+110610|C:\\\\windows\\\\System32\\\\KERNELBASE.dll+d68de|C:\\\\Users\\\\Public\\\\tools\\\\SysinternalsSuite\\\\procdump64.exe+120bb|C:\\\\windows\\\\System32\\\\KERNEL32.DLL+17bd4|C:\\\\windows\\\\SYSTEM32\\\\ntdll.dll+6ce51\"}]}}}", "category.generic": "Process", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "22356", "datafield9": "C:\\windows\\SYSTEM32\\ntdll.dll+9ca14|C:\\windows\\SYSTEM32\\ntdll.dll+110610|C:\\windows\\System32\\KERNELBASE.dll+d68de|C:\\Users\\Public\\tools\\SysinternalsSuite\\procdump64.exe+120bb|C:\\windows\\System32\\KERNEL32.DLL+17bd4|C:\\windows\\SYSTEM32\\ntdll.dll+6ce51", "event_src.category": "Other", "event_src.fqdn": "laptop-ju4m3i0e", "event_src.host": "laptop-ju4m3i0e", "event_src.hostname": "laptop-ju4m3i0e", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_10_Process_access", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "10", "normalized": true, "object": "process", "object.process.fullpath": "c:\\windows\\system32\\lsass.exe", "object.process.guid": "00247c92-ee6b-5f04-0000-00105c6ca859", "object.process.id": "30096", "object.process.name": "lsass.exe", "object.process.path": "c:\\windows\\system32\\", "object.property": "GrantedAccess", "object.value": "0x1fffff", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-12T15:52:46.284Z", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\users\\public\\tools\\sysinternalssuite\\procdump64.exe", "subject.process.guid": "00247c92-ee6b-5f04-0000-00109069a859", "subject.process.id": "28528", "subject.process.name": "procdump64.exe", "subject.process.path": "c:\\users\\public\\tools\\sysinternalssuite\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2020-07-07T21:51:39.262Z", "type": "raw", "uuid": "47af0585-1e97-49db-a576-c4814b0ef0f2"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"_rule": "An_attempt_was_made_to_lsass_process", "action": "access", "category.generic": "Attack", "category.high": "Credential Access", "category.low": "OS Credential Dumping: LSASS Memory", "correlation_name": "An_attempt_was_made_to_lsass_process", "correlation_type": "incident", "count": 1, "event_src.category": "Other", "event_src.fqdn": "laptop-ju4m3i0e", "event_src.host": "laptop-ju4m3i0e", "event_src.hostname": "laptop-ju4m3i0e", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "correlationengine", "importance": "high", "incident.aggregation.key": "An_attempt_was_made_to_lsass_process|laptop-ju4m3i0e|procdump64.exe|", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "normalized": true, "object": "process", "object.process.fullpath": "c:\\windows\\system32\\lsass.exe", "object.process.guid": "00247c92-ee6b-5f04-0000-00105c6ca859", "object.process.id": "30096", "object.process.name": "lsass.exe", "object.process.path": "c:\\windows\\system32\\", "object.property": "GrantedAccess", "object.value": "0x1fffff", "origin_app_id": "00000000-0000-0000-0000-000000000005", "primary_siem_app_id": "00000000-0000-0000-0000-000000000005", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\users\\public\\tools\\sysinternalssuite\\procdump64.exe", "subject.process.guid": "00247c92-ee6b-5f04-0000-00109069a859", "subject.process.id": "28528", "subject.process.name": "procdump64.exe", "subject.process.path": "c:\\users\\public\\tools\\sysinternalssuite\\"}
