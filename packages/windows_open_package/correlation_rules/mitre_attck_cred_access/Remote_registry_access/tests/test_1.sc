{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"5145\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12811\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-06-13T08:03:45.1093750Z\"},\"EventRecordID\":\"11412798\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"512\",\"ThreadID\":\"520\"},\"Channel\":\"Security\",\"Computer\":\"dc01.stand2008.local\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-3800063338-4262557262-2801230003-1603\"},{\"Name\":\"SubjectUserName\",\"text\":\"adm_back\"},{\"Name\":\"SubjectDomainName\",\"text\":\"STAND2008\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x97f06\"},{\"Name\":\"ObjectType\",\"text\":\"File\"},{\"Name\":\"IpAddress\",\"text\":\"192.168.224.50\"},{\"Name\":\"IpPort\",\"text\":\"54783\"},{\"Name\":\"ShareName\",\"text\":\"\\\\\\\\*\\\\IPC$\"},{\"Name\":\"ShareLocalPath\"},{\"Name\":\"RelativeTargetName\",\"text\":\"winreg\"},{\"Name\":\"AccessMask\",\"text\":\"0x12019f\"},{\"Name\":\"AccessList\",\"text\":\"%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424\"},{\"Name\":\"AccessReason\",\"text\":\"-\"}]}}}", "category.generic": "File System Object", "category.high": "System Management", "category.low": "Manipulation", "datafield6": "0x12019f", "datafield9": "READ_CONTROL|SYNCHRONIZE|ReadData (or ListDirectory)|WriteData (or AddFile)|AppendData (or AddSubdirectory or CreatePipeInstance)|ReadEA|WriteEA|ReadAttributes|WriteAttributes", "dst.fqdn": "dc01.stand2008.local", "dst.host": "dc01.stand2008.local", "dst.hostname": "dc01", "event_src.category": "Operating system", "event_src.fqdn": "dc01.stand2008.local", "event_src.host": "dc01.stand2008.local", "event_src.hostname": "dc01", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_5145_A_network_share_object_was_checked", "importance": "medium", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "5145", "normalized": true, "object": "file_object", "object.fullpath": "\\ipc$\\winreg", "object.name": "winreg", "object.path": "\\ipc$\\", "object.storage.fullpath": "\\winreg", "object.storage.id": "\\\\*\\ipc$", "object.storage.name": "winreg", "object.storage.path": "\\", "object.type": "file", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-13T08:41:54.820Z", "src.host": "192.168.224.50", "src.ip": "192.168.224.50", "src.port": 54783, "status": "success", "subject": "account", "subject.account.domain": "stand2008", "subject.account.id": "S-1-5-21-3800063338-4262557262-2801230003-1603", "subject.account.name": "adm_back", "subject.account.privileges": "%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424", "subject.account.session_id": "622342", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-06-13T08:03:45.109Z", "type": "raw", "uuid": "ea3ca7e4-5f8a-4b2a-96bb-7298b4065e63"}
{"action": "elevate", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4672\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12548\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-06-13T08:03:45.0937500Z\"},\"EventRecordID\":\"11412795\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"512\",\"ThreadID\":\"1208\"},\"Channel\":\"Security\",\"Computer\":\"dc01.stand2008.local\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-3800063338-4262557262-2801230003-1603\"},{\"Name\":\"SubjectUserName\",\"text\":\"adm_back\"},{\"Name\":\"SubjectDomainName\",\"text\":\"STAND2008\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x97f06\"},{\"Name\":\"PrivilegeList\",\"text\":\"SeBackupPrivilege SeRestorePrivilege\"}]}}}", "category.generic": "Account", "category.high": "Users And Rights Management", "category.low": "Manipulation", "dst.fqdn": "dc01.stand2008.local", "dst.host": "dc01.stand2008.local", "dst.hostname": "dc01", "event_src.category": "AAA", "event_src.fqdn": "dc01.stand2008.local", "event_src.host": "dc01.stand2008.local", "event_src.hostname": "dc01", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4672_Special_privileges_assigned_to_new_logon", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4672", "normalized": true, "object": "account", "object.account.domain": "stand2008", "object.account.id": "S-1-5-21-3800063338-4262557262-2801230003-1603", "object.account.name": "adm_back", "object.account.privileges": "SeBackupPrivilege SeRestorePrivilege", "object.account.session_id": "622342", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-13T08:41:54.823Z", "src.fqdn": "dc01.stand2008.local", "src.host": "dc01.stand2008.local", "src.hostname": "dc01", "status": "success", "subject": "account", "subject.account.domain": "stand2008", "subject.account.id": "S-1-5-21-3800063338-4262557262-2801230003-1603", "subject.account.name": "adm_back", "subject.account.session_id": "622342", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-06-13T08:03:45.093Z", "type": "raw", "uuid": "0915db36-a28f-4471-93cc-9c41a6f778de"}
{"action": "login", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4624\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12544\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-06-13T08:03:45.0937500Z\"},\"EventRecordID\":\"11412796\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"512\",\"ThreadID\":\"1208\"},\"Channel\":\"Security\",\"Computer\":\"dc01.stand2008.local\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-0-0\"},{\"Name\":\"SubjectUserName\",\"text\":\"-\"},{\"Name\":\"SubjectDomainName\",\"text\":\"-\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x0\"},{\"Name\":\"TargetUserSid\",\"text\":\"S-1-5-21-3800063338-4262557262-2801230003-1603\"},{\"Name\":\"TargetUserName\",\"text\":\"adm_back\"},{\"Name\":\"TargetDomainName\",\"text\":\"STAND2008\"},{\"Name\":\"TargetLogonId\",\"text\":\"0x97f06\"},{\"Name\":\"LogonType\",\"text\":\"3\"},{\"Name\":\"LogonProcessName\",\"text\":\"Kerberos\"},{\"Name\":\"AuthenticationPackageName\",\"text\":\"Kerberos\"},{\"Name\":\"WorkstationName\"},{\"Name\":\"LogonGuid\",\"text\":\"{2a0e1034-b8ef-65ad-afa3-48bb81157893}\"},{\"Name\":\"TransmittedServices\",\"text\":\"-\"},{\"Name\":\"LmPackageName\",\"text\":\"-\"},{\"Name\":\"KeyLength\",\"text\":\"0\"},{\"Name\":\"ProcessId\",\"text\":\"0x0\"},{\"Name\":\"ProcessName\",\"text\":\"-\"},{\"Name\":\"IpAddress\",\"text\":\"192.168.224.50\"},{\"Name\":\"IpPort\",\"text\":\"54783\"}]}}}", "category.generic": "Operating System", "category.high": "Access Management", "category.low": "Communication", "datafield6": "Network", "datafield9": "Kerberos", "dst.fqdn": "dc01.stand2008.local", "dst.host": "dc01.stand2008.local", "dst.hostname": "dc01", "event_src.category": "AAA", "event_src.fqdn": "dc01.stand2008.local", "event_src.host": "dc01.stand2008.local", "event_src.hostname": "dc01", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4624_An_account_was_successfully_logged_on", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "logon_auth_method": "remote", "logon_service": "Kerberos", "logon_type": 3, "mime": "application/x-pt-eventlog", "msgid": "4624", "normalized": true, "object": "system", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-13T08:41:54.823Z", "src.host": "192.168.224.50", "src.ip": "192.168.224.50", "src.port": 54783, "status": "success", "subject": "account", "subject.account.domain": "stand2008", "subject.account.id": "S-1-5-21-3800063338-4262557262-2801230003-1603", "subject.account.name": "adm_back", "subject.account.session_id": "622342", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-06-13T08:03:45.093Z", "type": "raw", "uuid": "b57dbb0c-2a91-4e3b-872e-2ed8587756ad"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"action": "access", "category.generic": "Attack", "category.high": "Credential Access", "category.low": "OS Credential Dumping: Security Account Manager", "correlation_name": "Remote_registry_access", "correlation_type": "incident", "datafield6": "0x12019f", "datafield9": "%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424", "dst.fqdn": "dc01.stand2008.local", "dst.host": "dc01.stand2008.local", "dst.hostname": "dc01", "event_src.category": "Operating system", "event_src.fqdn": "dc01.stand2008.local", "event_src.host": "dc01.stand2008.local", "event_src.hostname": "dc01", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "importance": "medium", "incident.aggregation.key": "Remote_registry_access|622342", "incident.aggregation.timeout": 3600, "incident.category": "Undefined", "incident.severity": "medium", "object": "file_object", "object.fullpath": "\\ipc$\\winreg", "object.name": "winreg", "object.path": "\\ipc$\\", "object.storage.fullpath": "\\winreg", "object.storage.id": "\\\\*\\ipc$", "object.storage.name": "winreg", "object.storage.path": "\\", "src.host": "192.168.224.50", "src.ip": "192.168.224.50", "src.port": 54783, "status": "success", "subject": "account", "subject.account.domain": "stand2008", "subject.account.id": "S-1-5-21-3800063338-4262557262-2801230003-1603", "subject.account.name": "adm_back", "subject.account.privileges": "READ_CONTROL|SYNCHRONIZE|ReadData (or ListDirectory)|WriteData (or AddFile)|AppendData (or AddSubdirectory or CreatePipeInstance)|ReadEA|WriteEA|ReadAttributes|WriteAttributes", "subject.account.session_id": "622342", "subject.privileges": "SeBackupPrivilege SeRestorePrivilege"}
