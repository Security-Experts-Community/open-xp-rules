{"action": "start", "body": "{ \"Event\": { \"xmlns\": \"http://schemas.microsoft.com/win/2004/08/events/event\", \"System\": { \"Provider\": { \"Name\": \"Microsoft-Windows-Sysmon\", \"Guid\": \"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}\" }, \"EventID\": \"1\", \"Version\": \"5\", \"Level\": \"4\", \"Task\": \"1\", \"Opcode\": \"0\", \"Keywords\": \"0x8000000000000000\", \"TimeCreated\": { \"SystemTime\": \"2021-09-06T17:42:56.157650300Z\" }, \"EventRecordID\": \"1263128\", \"Correlation\": null, \"Execution\": { \"ProcessID\": \"1316\", \"ThreadID\": \"1724\" }, \"Channel\": \"Microsoft-Windows-Sysmon/Operational\", \"Computer\": \"Test_w7x64-131.testlab.org\", \"Security\": { \"UserID\": \"S-1-5-18\" } }, \"EventData\": { \"Data\": [ { \"Name\": \"RuleName\" }, { \"text\": \"2021-09-06 17:42:56.155\", \"Name\": \"UtcTime\" }, { \"text\": \"{7C221102-5320-6136-0000-00107650FA03}\", \"Name\": \"ProcessGuid\" }, { \"text\": \"341952\", \"Name\": \"ProcessId\" }, { \"text\": \"C:\\\\Users\\\\vasya\\\\Desktop\\\\mimi\\\\x64\\\\mimikatz.exe\", \"Name\": \"Image\" }, { \"text\": \"2.2.0.0\", \"Name\": \"FileVersion\" }, { \"text\": \"mimikatz for Windows\", \"Name\": \"Description\" }, { \"text\": \"mimikatz\", \"Name\": \"Product\" }, { \"text\": \"gentilkiwi (Benjamin DELPY)\", \"Name\": \"Company\" }, { \"text\": \"mimikatz.exe\", \"Name\": \"OriginalFileName\" }, { \"text\": \"\\\"C:\\\\Users\\\\vasya\\\\Desktop\\\\mimi\\\\x64\\\\mimikatz.exe\\\"\", \"Name\": \"CommandLine\" }, { \"text\": \"C:\\\\Users\\\\vasya\\\\Desktop\\\\mimi\\\\x64\\\\\", \"Name\": \"CurrentDirectory\" }, { \"text\": \"TESTLAB\\\\vasya\", \"Name\": \"User\" }, { \"text\": \"{7C221102-5246-6136-0000-0020E180F103}\", \"Name\": \"LogonGuid\" }, { \"text\": \"0x3f180e1\", \"Name\": \"LogonId\" }, { \"text\": \"2\", \"Name\": \"TerminalSessionId\" }, { \"text\": \"High\", \"Name\": \"IntegrityLevel\" }, { \"text\": \"MD5=BB8BDB3E8C92E97E2F63626BC3B254C4,SHA256=912018AB3C6B16B39EE84F17745FF0C80A33CEE241013EC35D0281E40C0658D9\", \"Name\": \"Hashes\" }, { \"text\": \"{7C221102-52F8-6136-0000-00101D0BFA03}\", \"Name\": \"ParentProcessGuid\" }, { \"text\": \"341612\", \"Name\": \"ParentProcessId\" }, { \"text\": \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \"Name\": \"ParentImage\" }, { \"text\": \"\\\"C:\\\\WINDOWS\\\\system32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\\\" \", \"Name\": \"ParentCommandLine\" } ] }, \"RenderingInfo\": { \"Culture\": \"en-US\", \"Message\": \"Process Create:\\r\\nRuleName: \\r\\nUtcTime: 2021-09-06 17:42:56.155\\r\\nProcessGuid: {7C221102-5320-6136-0000-00107650FA03}\\r\\nProcessId: 341952\\r\\nImage: C:\\\\Users\\\\vasya\\\\Desktop\\\\mimi\\\\x64\\\\mimikatz.exe\\r\\nFileVersion: 2.2.0.0\\r\\nDescription: mimikatz for Windows\\r\\nProduct: mimikatz\\r\\nCompany: gentilkiwi (Benjamin DELPY)\\r\\nOriginalFileName: mimikatz.exe\\r\\nCommandLine: \\\"C:\\\\Users\\\\vasya\\\\Desktop\\\\mimi\\\\x64\\\\mimikatz.exe\\\"\\r\\nCurrentDirectory: C:\\\\Users\\\\vasya\\\\Desktop\\\\mimi\\\\x64\\\\\\r\\nUser: TESTLAB\\\\vasya\\r\\nLogonGuid: {7C221102-5246-6136-0000-0020E180F103}\\r\\nLogonId: 0x3f180e1\\r\\nTerminalSessionId: 2\\r\\nIntegrityLevel: High\\r\\nHashes: MD5=BB8BDB3E8C92E97E2F63626BC3B254C4,SHA256=912018AB3C6B16B39EE84F17745FF0C80A33CEE241013EC35D0281E40C0658D9\\r\\nParentProcessGuid: {7C221102-52F8-6136-0000-00101D0BFA03}\\r\\nParentProcessId: 341612\\r\\nParentImage: C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\\r\\nParentCommandLine: \\\"C:\\\\WINDOWS\\\\system32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\\\" \", \"Level\": \"Information\", \"Task\": \"Process Create (rule: ProcessCreate)\", \"Opcode\": \"Info\", \"Channel\": null, \"Provider\": null, \"Keywords\": null } } }", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "datafield6": "7C221102-5246-6136-0000-0020E180F103", "event_src.category": "Other", "event_src.fqdn": "test_w7x64-131.testlab.org", "event_src.host": "test_w7x64-131.testlab.org", "event_src.hostname": "test_w7x64-131", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_1_Process_creation", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "1", "normalized": true, "object": "process", "object.account.domain": "testlab", "object.account.id": "synthetic:vasya@testlab", "object.account.name": "vasya", "object.account.privileges": "High", "object.account.session_id": "66158817", "object.process.cmdline": "\"C:\\Users\\vasya\\Desktop\\mimi\\x64\\mimikatz.exe\"", "object.process.cwd": "C:\\Users\\vasya\\Desktop\\mimi\\x64\\", "object.process.fullpath": "c:\\users\\vasya\\desktop\\mimi\\x64\\mimikatz.exe", "object.process.guid": "7C221102-5320-6136-0000-00107650FA03", "object.process.hash.md5": "BB8BDB3E8C92E97E2F63626BC3B254C4", "object.process.hash.sha256": "912018AB3C6B16B39EE84F17745FF0C80A33CEE241013EC35D0281E40C0658D9", "object.process.id": "341952", "object.process.meta": "Description:mimikatz for Windows | Product:mimikatz | Company:gentilkiwi (Benjamin DELPY)", "object.process.name": "mimikatz.exe", "object.process.original_name": "mimikatz.exe", "object.process.parent.cmdline": "\"C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe\"", "object.process.parent.fullpath": "c:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "object.process.parent.guid": "7C221102-52F8-6136-0000-00101D0BFA03", "object.process.parent.id": "341612", "object.process.parent.name": "powershell.exe", "object.process.parent.path": "c:\\windows\\system32\\windowspowershell\\v1.0\\", "object.process.path": "c:\\users\\vasya\\desktop\\mimi\\x64\\", "object.process.version": "2.2.0.0", "recv_ipv4": "127.0.0.1", "recv_time": "2021-09-09T13:33:10Z", "status": "success", "subject": "account", "subject.account.domain": "testlab", "subject.account.id": "synthetic:vasya@testlab", "subject.account.name": "vasya", "subject.account.privileges": "High", "subject.account.session_id": "66158817", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-09-06T17:42:56.155Z", "type": "raw", "uuid": "7530d5f1-b693-4aec-8286-5694335292e9"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"action": "start", "category.generic": "Attack", "category.high": "Credential Access", "category.low": "OS Credential Dumping", "correlation_name": "Mimikatz", "correlation_type": "incident", "datafield6": "7C221102-5246-6136-0000-0020E180F103", "event_src.fqdn": "test_w7x64-131.testlab.org", "event_src.host": "test_w7x64-131.testlab.org", "event_src.hostname": "test_w7x64-131", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "medium", "incident.aggregation.key": "Mimikatz|test_w7x64-131.testlab.org|synthetic:vasya@testlab", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "medium", "object": "process", "object.account.domain": "testlab", "object.account.id": "synthetic:vasya@testlab", "object.account.name": "vasya", "object.account.session_id": "66158817", "object.process.cmdline": "\"C:\\Users\\vasya\\Desktop\\mimi\\x64\\mimikatz.exe\"", "object.process.cwd": "C:\\Users\\vasya\\Desktop\\mimi\\x64\\", "object.process.fullpath": "c:\\users\\vasya\\desktop\\mimi\\x64\\mimikatz.exe", "object.process.guid": "7C221102-5320-6136-0000-00107650FA03", "object.process.hash.md5": "BB8BDB3E8C92E97E2F63626BC3B254C4", "object.process.hash.sha256": "912018AB3C6B16B39EE84F17745FF0C80A33CEE241013EC35D0281E40C0658D9", "object.process.id": "341952", "object.process.meta": "Description:mimikatz for Windows | Product:mimikatz | Company:gentilkiwi (Benjamin DELPY)", "object.process.name": "mimikatz.exe", "object.process.original_name": "mimikatz.exe", "object.process.parent.cmdline": "\"C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe\"", "object.process.parent.fullpath": "c:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "object.process.parent.guid": "7C221102-52F8-6136-0000-00101D0BFA03", "object.process.parent.id": "341612", "object.process.parent.name": "powershell.exe", "object.process.parent.path": "c:\\windows\\system32\\windowspowershell\\v1.0\\", "object.process.path": "c:\\users\\vasya\\desktop\\mimi\\x64\\", "object.process.version": "2.2.0.0", "status": "success", "subject": "account", "subject.account.domain": "testlab", "subject.account.id": "synthetic:vasya@testlab", "subject.account.name": "vasya", "subject.account.privileges": "High", "subject.account.session_id": "66158817"}