{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"1\",\"Version\":\"5\",\"Level\":\"4\",\"Task\":\"1\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-04-22T22:09:35.2842251Z\"},\"EventRecordID\":\"564605\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"3352\",\"ThreadID\":\"4696\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"MSEDGEWIN10\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2021-04-22 22:09:35.263\"},{\"Name\":\"ProcessGuid\",\"text\":\"{747f3d96-f41f-6081-0000-001078834a00}\"},{\"Name\":\"ProcessId\",\"text\":\"6644\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Windows\\\\System32\\\\svchost.exe\"},{\"Name\":\"FileVersion\",\"text\":\"10.0.17763.1 (WinBuild.160101.0800)\"},{\"Name\":\"Description\",\"text\":\"Host Process for Windows Services\"},{\"Name\":\"Product\",\"text\":\"Microsoft® Windows® Operating System\"},{\"Name\":\"Company\",\"text\":\"Microsoft Corporation\"},{\"Name\":\"OriginalFileName\",\"text\":\"svchost.exe\"},{\"Name\":\"CommandLine\",\"text\":\"C:\\\\Windows\\\\system32\\\\svchost.exe -k LocalService -p -s fdPHost\"},{\"Name\":\"CurrentDirectory\",\"text\":\"C:\\\\Windows\\\\system32\\\\\"},{\"Name\":\"User\",\"text\":\"NT AUTHORITY\\\\LOCAL SERVICE\"},{\"Name\":\"LogonGuid\",\"text\":\"{747f3d96-6e1a-6082-0000-0020e5030000}\"},{\"Name\":\"LogonId\",\"text\":\"0x3e5\"},{\"Name\":\"TerminalSessionId\",\"text\":\"0\"},{\"Name\":\"IntegrityLevel\",\"text\":\"System\"},{\"Name\":\"Hashes\",\"text\":\"SHA1=A1385CE20AD79F55DF235EFFD9780C31442AA234,MD5=8A0A29438052FAED8A2532DA50455756,SHA256=7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69\"},{\"Name\":\"ParentProcessGuid\",\"text\":\"{00000000-0000-0000-0000-000000000000}\"},{\"Name\":\"ParentProcessId\",\"text\":\"624\"},{\"Name\":\"ParentImage\",\"text\":\"?\"},{\"Name\":\"ParentCommandLine\",\"text\":\"?\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "datafield6": "747f3d96-6e1a-6082-0000-0020e5030000", "event_src.category": "Other", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_1_Process_creation", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "1", "normalized": true, "object": "process", "object.account.domain": "nt authority", "object.account.id": "synthetic:local service@nt authority", "object.account.name": "local service", "object.account.privileges": "System", "object.account.session_id": "997", "object.process.cmdline": "C:\\Windows\\system32\\svchost.exe -k LocalService -p -s fdPHost", "object.process.cwd": "C:\\Windows\\system32\\", "object.process.fullpath": "c:\\windows\\system32\\svchost.exe", "object.process.guid": "747f3d96-f41f-6081-0000-001078834a00", "object.process.hash.imphash": "247B9220E5D9B720A82B2C8B5069AD69", "object.process.hash.md5": "8A0A29438052FAED8A2532DA50455756", "object.process.hash.sha1": "A1385CE20AD79F55DF235EFFD9780C31442AA234", "object.process.hash.sha256": "7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6", "object.process.id": "6644", "object.process.meta": "Description:Host Process for Windows Services | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "svchost.exe", "object.process.original_name": "svchost.exe", "object.process.parent.cmdline": "?", "object.process.parent.fullpath": "?", "object.process.parent.guid": "00000000-0000-0000-0000-000000000000", "object.process.parent.id": "624", "object.process.parent.name": "?", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "10.0.17763.1 (WinBuild.160101.0800)", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-14T19:05:54.727Z", "status": "success", "subject": "account", "subject.account.domain": "nt authority", "subject.account.id": "synthetic:local service@nt authority", "subject.account.name": "local service", "subject.account.privileges": "System", "subject.account.session_id": "997", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-04-22T22:09:35.263Z", "type": "raw", "uuid": "990452ea-e6c1-474f-9548-a07ae741a722"}
{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"10\",\"Version\":\"3\",\"Level\":\"4\",\"Task\":\"10\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-04-22T22:09:35.2846041Z\"},\"EventRecordID\":\"564606\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"3352\",\"ThreadID\":\"4696\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"MSEDGEWIN10\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2021-04-22 22:09:35.276\"},{\"Name\":\"SourceProcessGUID\",\"text\":\"{747f3d96-6e19-6082-0000-0010f6600000}\"},{\"Name\":\"SourceProcessId\",\"text\":\"624\"},{\"Name\":\"SourceThreadId\",\"text\":\"2368\"},{\"Name\":\"SourceImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\services.exe\"},{\"Name\":\"TargetProcessGUID\",\"text\":\"{747f3d96-f41f-6081-0000-001078834a00}\"},{\"Name\":\"TargetProcessId\",\"text\":\"6644\"},{\"Name\":\"TargetImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\svchost.exe\"},{\"Name\":\"GrantedAccess\",\"text\":\"0x1fffff\"},{\"Name\":\"CallTrace\",\"text\":\"C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+a0fb4|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+485d2|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+45163|C:\\\\Windows\\\\System32\\\\KERNEL32.DLL+1cd9f|C:\\\\Windows\\\\system32\\\\services.exe+9f39|C:\\\\Windows\\\\system32\\\\services.exe+c665|C:\\\\Windows\\\\system32\\\\services.exe+90d5|C:\\\\Windows\\\\system32\\\\services.exe+8d4c|C:\\\\Windows\\\\system32\\\\services.exe+de2d|C:\\\\Windows\\\\system32\\\\services.exe+15a8e|C:\\\\Windows\\\\system32\\\\services.exe+15d78|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+77803|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+1436c|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+1756a|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+54a18|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+30490|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+2fe3b|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+221ff|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+2165a|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+20c21|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+20692|C:\\\\Windows\\\\System32\\\\RPCRT4.dll+17465|C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+4f4d0|C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+50358\"}]}}}", "category.generic": "Process", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "2368", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+a0fb4|C:\\Windows\\System32\\KERNELBASE.dll+485d2|C:\\Windows\\System32\\KERNELBASE.dll+45163|C:\\Windows\\System32\\KERNEL32.DLL+1cd9f|C:\\Windows\\system32\\services.exe+9f39|C:\\Windows\\system32\\services.exe+c665|C:\\Windows\\system32\\services.exe+90d5|C:\\Windows\\system32\\services.exe+8d4c|C:\\Windows\\system32\\services.exe+de2d|C:\\Windows\\system32\\services.exe+15a8e|C:\\Windows\\system32\\services.exe+15d78|C:\\Windows\\System32\\RPCRT4.dll+77803|C:\\Windows\\System32\\RPCRT4.dll+1436c|C:\\Windows\\System32\\RPCRT4.dll+1756a|C:\\Windows\\System32\\RPCRT4.dll+54a18|C:\\Windows\\System32\\RPCRT4.dll+30490|C:\\Windows\\System32\\RPCRT4.dll+2fe3b|C:\\Windows\\System32\\RPCRT4.dll+221ff|C:\\Windows\\System32\\RPCRT4.dll+2165a|C:\\Windows\\System32\\RPCRT4.dll+20c21|C:\\Windows\\System32\\RPCRT4.dll+20692|C:\\Windows\\System32\\RPCRT4.dll+17465|C:\\Windows\\SYSTEM32\\ntdll.dll+4f4d0|C:\\Windows\\SYSTEM32\\ntdll.dll+50358", "event_src.category": "Other", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_10_Process_access", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "10", "normalized": true, "object": "process", "object.process.fullpath": "c:\\windows\\system32\\svchost.exe", "object.process.guid": "747f3d96-f41f-6081-0000-001078834a00", "object.process.id": "6644", "object.process.name": "svchost.exe", "object.process.path": "c:\\windows\\system32\\", "object.property": "GrantedAccess", "object.value": "0x1fffff", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-14T19:05:54.727Z", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\windows\\system32\\services.exe", "subject.process.guid": "747f3d96-6e19-6082-0000-0010f6600000", "subject.process.id": "624", "subject.process.name": "services.exe", "subject.process.path": "c:\\windows\\system32\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-04-22T22:09:35.276Z", "type": "raw", "uuid": "71be7ec4-775e-4545-8608-32b6e6aa7510"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"action": "start", "category.generic": "Attack", "category.high": "Credential Access", "category.low": "OS Credential Dumping", "correlation_name": "PPL_Bypass_via_PPLDump_Tool", "correlation_type": "incident", "datafield5": "2368", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+a0fb4|C:\\Windows\\System32\\KERNELBASE.dll+485d2|C:\\Windows\\System32\\KERNELBASE.dll+45163|C:\\Windows\\System32\\KERNEL32.DLL+1cd9f|C:\\Windows\\system32\\services.exe+9f39|C:\\Windows\\system32\\services.exe+c665|C:\\Windows\\system32\\services.exe+90d5|C:\\Windows\\system32\\services.exe+8d4c|C:\\Windows\\system32\\services.exe+de2d|C:\\Windows\\system32\\services.exe+15a8e|C:\\Windows\\system32\\services.exe+15d78|C:\\Windows\\System32\\RPCRT4.dll+77803|C:\\Windows\\System32\\RPCRT4.dll+1436c|C:\\Windows\\System32\\RPCRT4.dll+1756a|C:\\Windows\\System32\\RPCRT4.dll+54a18|C:\\Windows\\System32\\RPCRT4.dll+30490|C:\\Windows\\System32\\RPCRT4.dll+2fe3b|C:\\Windows\\System32\\RPCRT4.dll+221ff|C:\\Windows\\System32\\RPCRT4.dll+2165a|C:\\Windows\\System32\\RPCRT4.dll+20c21|C:\\Windows\\System32\\RPCRT4.dll+20692|C:\\Windows\\System32\\RPCRT4.dll+17465|C:\\Windows\\SYSTEM32\\ntdll.dll+4f4d0|C:\\Windows\\SYSTEM32\\ntdll.dll+50358", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "high", "incident.aggregation.key": "PPL_Bypass_via_PPLDump_Tool|msedgewin10|C:\\Windows\\system32\\svchost.exe -k LocalService -p -s fdPHost", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "object": "process", "object.account.domain": "nt authority", "object.account.id": "synthetic:local service@nt authority", "object.account.name": "local service", "object.account.session_id": "997", "object.process.cmdline": "C:\\Windows\\system32\\svchost.exe -k LocalService -p -s fdPHost", "object.process.cwd": "C:\\Windows\\system32\\", "object.process.fullpath": "c:\\windows\\system32\\svchost.exe", "object.process.guid": "747f3d96-f41f-6081-0000-001078834a00", "object.process.hash.md5": "8A0A29438052FAED8A2532DA50455756", "object.process.hash.sha1": "A1385CE20AD79F55DF235EFFD9780C31442AA234", "object.process.hash.sha256": "7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6", "object.process.id": "6644", "object.process.meta": "Description:Host Process for Windows Services | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "svchost.exe", "object.process.original_name": "svchost.exe", "object.process.parent.cmdline": "?", "object.process.parent.fullpath": "?", "object.process.parent.guid": "00000000-0000-0000-0000-000000000000", "object.process.parent.id": "624", "object.process.parent.name": "?", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "10.0.17763.1 (WinBuild.160101.0800)", "status": "success", "subject": "account", "subject.account.domain": "nt authority", "subject.account.id": "synthetic:local service@nt authority", "subject.account.name": "local service", "subject.account.privileges": "System", "subject.account.session_id": "997", "subject.process.fullpath": "c:\\windows\\system32\\services.exe", "subject.process.guid": "747f3d96-6e19-6082-0000-0010f6600000", "subject.process.id": "624", "subject.process.name": "services.exe"}
