{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"1\",\"Version\":\"5\",\"Level\":\"4\",\"Task\":\"1\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-04-22T22:09:26.0813373Z\"},\"EventRecordID\":\"564593\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"3352\",\"ThreadID\":\"4696\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"MSEDGEWIN10\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2021-04-22 22:09:26.016\"},{\"Name\":\"ProcessGuid\",\"text\":\"{747f3d96-f416-6081-0000-001033034a00}\"},{\"Name\":\"ProcessId\",\"text\":\"7188\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Windows\\\\System32\\\\services.exe\"},{\"Name\":\"FileVersion\",\"text\":\"10.0.17763.1075 (WinBuild.160101.0800)\"},{\"Name\":\"Description\",\"text\":\"Services and Controller app\"},{\"Name\":\"Product\",\"text\":\"Microsoft® Windows® Operating System\"},{\"Name\":\"Company\",\"text\":\"Microsoft Corporation\"},{\"Name\":\"OriginalFileName\",\"text\":\"services.exe\"},{\"Name\":\"CommandLine\",\"text\":\"C:\\\\Windows\\\\system32\\\\services.exe 652 \\\"lsass.dmp\\\" a708b1d9-e27b-48bc-8ea7-c56d3a23f99 -v\"},{\"Name\":\"CurrentDirectory\",\"text\":\"c:\\\\Users\\\\IEUser\\\\Desktop\\\\\"},{\"Name\":\"User\",\"text\":\"NT AUTHORITY\\\\SYSTEM\"},{\"Name\":\"LogonGuid\",\"text\":\"{747f3d96-6e19-6082-0000-0020e7030000}\"},{\"Name\":\"LogonId\",\"text\":\"0x3e7\"},{\"Name\":\"TerminalSessionId\",\"text\":\"1\"},{\"Name\":\"IntegrityLevel\",\"text\":\"System\"},{\"Name\":\"Hashes\",\"text\":\"SHA1=617A0A0BAAB180541DB739C4A6851D784943C317,MD5=DB896369FB58241ADF28515E3765C514,SHA256=A2E369DF26C88015FE1F97C7542D6023B5B1E4830C25F94819507EE5BCB1DFCC,IMPHASH=7D2820FC8CAF521DC2058168B480D204\"},{\"Name\":\"ParentProcessGuid\",\"text\":\"{747f3d96-f415-6081-0000-001040fe4900}\"},{\"Name\":\"ParentProcessId\",\"text\":\"6316\"},{\"Name\":\"ParentImage\",\"text\":\"C:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe\"},{\"Name\":\"ParentCommandLine\",\"text\":\"PPLdump.exe -v lsass lsass.dmp\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "datafield6": "747f3d96-6e19-6082-0000-0020e7030000", "event_src.category": "Other", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_1_Process_creation", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "1", "normalized": true, "object": "process", "object.account.domain": "nt authority", "object.account.id": "synthetic:system@nt authority", "object.account.name": "system", "object.account.privileges": "System", "object.account.session_id": "999", "object.process.cmdline": "C:\\Windows\\system32\\services.exe 652 \"lsass.dmp\" a708b1d9-e27b-48bc-8ea7-c56d3a23f99 -v", "object.process.cwd": "c:\\Users\\IEUser\\Desktop\\", "object.process.fullpath": "c:\\windows\\system32\\services.exe", "object.process.guid": "747f3d96-f416-6081-0000-001033034a00", "object.process.hash.imphash": "7D2820FC8CAF521DC2058168B480D204", "object.process.hash.md5": "DB896369FB58241ADF28515E3765C514", "object.process.hash.sha1": "617A0A0BAAB180541DB739C4A6851D784943C317", "object.process.hash.sha256": "A2E369DF26C88015FE1F97C7542D6023B5B1E4830C25F94819507EE5BCB1DFCC", "object.process.id": "7188", "object.process.meta": "Description:Services and Controller app | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "services.exe", "object.process.original_name": "services.exe", "object.process.parent.cmdline": "PPLdump.exe -v lsass lsass.dmp", "object.process.parent.fullpath": "c:\\users\\ieuser\\desktop\\ppldump.exe", "object.process.parent.guid": "747f3d96-f415-6081-0000-001040fe4900", "object.process.parent.id": "6316", "object.process.parent.name": "ppldump.exe", "object.process.parent.path": "c:\\users\\ieuser\\desktop\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "10.0.17763.1075 (WinBuild.160101.0800)", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-14T19:00:22.549Z", "status": "success", "subject": "account", "subject.account.domain": "nt authority", "subject.account.id": "synthetic:system@nt authority", "subject.account.name": "system", "subject.account.privileges": "System", "subject.account.session_id": "999", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-04-22T22:09:26.016Z", "type": "raw", "uuid": "8aa256e5-1783-4d78-bb1e-b60d5d861d68"}
{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"10\",\"Version\":\"3\",\"Level\":\"4\",\"Task\":\"10\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-04-22T22:09:26.0831522Z\"},\"EventRecordID\":\"564594\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"3352\",\"ThreadID\":\"4696\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"MSEDGEWIN10\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2021-04-22 22:09:26.066\"},{\"Name\":\"SourceProcessGUID\",\"text\":\"{747f3d96-f415-6081-0000-001040fe4900}\"},{\"Name\":\"SourceProcessId\",\"text\":\"6316\"},{\"Name\":\"SourceThreadId\",\"text\":\"2544\"},{\"Name\":\"SourceImage\",\"text\":\"c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe\"},{\"Name\":\"TargetProcessGUID\",\"text\":\"{747f3d96-f416-6081-0000-001033034a00}\"},{\"Name\":\"TargetProcessId\",\"text\":\"7188\"},{\"Name\":\"TargetImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\services.exe\"},{\"Name\":\"GrantedAccess\",\"text\":\"0x103801\"},{\"Name\":\"CallTrace\",\"text\":\"C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+a0fb4|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+485d2|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+45163|C:\\\\Windows\\\\System32\\\\ADVAPI32.dll+1c20f|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+1c47|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+35c6|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+45f8|C:\\\\Windows\\\\System32\\\\KERNEL32.DLL+17974|C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+6a271\"}]}}}", "category.generic": "Process", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "2544", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+a0fb4|C:\\Windows\\System32\\KERNELBASE.dll+485d2|C:\\Windows\\System32\\KERNELBASE.dll+45163|C:\\Windows\\System32\\ADVAPI32.dll+1c20f|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+1c47|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+35c6|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+45f8|C:\\Windows\\System32\\KERNEL32.DLL+17974|C:\\Windows\\SYSTEM32\\ntdll.dll+6a271", "event_src.category": "Other", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_10_Process_access", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "10", "normalized": true, "object": "process", "object.process.fullpath": "c:\\windows\\system32\\services.exe", "object.process.guid": "747f3d96-f416-6081-0000-001033034a00", "object.process.id": "7188", "object.process.name": "services.exe", "object.process.path": "c:\\windows\\system32\\", "object.property": "GrantedAccess", "object.value": "0x103801", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-14T19:00:22.549Z", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\users\\ieuser\\desktop\\ppldump.exe", "subject.process.guid": "747f3d96-f415-6081-0000-001040fe4900", "subject.process.id": "6316", "subject.process.name": "ppldump.exe", "subject.process.path": "c:\\users\\ieuser\\desktop\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-04-22T22:09:26.066Z", "type": "raw", "uuid": "3182b375-c9ee-4c6e-844b-010b44ca4ce1"}
{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"10\",\"Version\":\"3\",\"Level\":\"4\",\"Task\":\"10\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-04-22T22:09:26.0847648Z\"},\"EventRecordID\":\"564595\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"3352\",\"ThreadID\":\"4696\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"MSEDGEWIN10\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2021-04-22 22:09:26.066\"},{\"Name\":\"SourceProcessGUID\",\"text\":\"{747f3d96-6e19-6082-0000-0010e5580000}\"},{\"Name\":\"SourceProcessId\",\"text\":\"504\"},{\"Name\":\"SourceThreadId\",\"text\":\"264\"},{\"Name\":\"SourceImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\csrss.exe\"},{\"Name\":\"TargetProcessGUID\",\"text\":\"{747f3d96-f416-6081-0000-001033034a00}\"},{\"Name\":\"TargetProcessId\",\"text\":\"7188\"},{\"Name\":\"TargetImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\services.exe\"},{\"Name\":\"GrantedAccess\",\"text\":\"0x1fffff\"},{\"Name\":\"CallTrace\",\"text\":\"C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+9fc24|C:\\\\Windows\\\\system32\\\\basesrv.DLL+2fda|C:\\\\Windows\\\\SYSTEM32\\\\CSRSRV.dll+5e2a|C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+6a27f\"}]}}}", "category.generic": "Process", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "264", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+9fc24|C:\\Windows\\system32\\basesrv.DLL+2fda|C:\\Windows\\SYSTEM32\\CSRSRV.dll+5e2a|C:\\Windows\\SYSTEM32\\ntdll.dll+6a27f", "event_src.category": "Other", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_10_Process_access", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "10", "normalized": true, "object": "process", "object.process.fullpath": "c:\\windows\\system32\\services.exe", "object.process.guid": "747f3d96-f416-6081-0000-001033034a00", "object.process.id": "7188", "object.process.name": "services.exe", "object.process.path": "c:\\windows\\system32\\", "object.property": "GrantedAccess", "object.value": "0x1fffff", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-14T19:00:22.549Z", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\windows\\system32\\csrss.exe", "subject.process.guid": "747f3d96-6e19-6082-0000-0010e5580000", "subject.process.id": "504", "subject.process.name": "csrss.exe", "subject.process.path": "c:\\windows\\system32\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-04-22T22:09:26.066Z", "type": "raw", "uuid": "4451a9cd-e6a6-481d-9934-ab8ebe2ca2e2"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 								{"action": "start", "category.generic": "Attack", "category.high": "Credential Access", "category.low": "OS Credential Dumping", "correlation_name": "PPL_Bypass_via_PPLDump_Tool", "correlation_type": "incident", "datafield5": "264", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+9fc24|C:\\Windows\\system32\\basesrv.DLL+2fda|C:\\Windows\\SYSTEM32\\CSRSRV.dll+5e2a|C:\\Windows\\SYSTEM32\\ntdll.dll+6a27f", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "high", "incident.aggregation.key": "PPL_Bypass_via_PPLDump_Tool|msedgewin10|C:\\Windows\\system32\\services.exe 652 \"lsass.dmp\" a708b1d9-e27b-48bc-8ea7-c56d3a23f99 -v", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "object": "process", "object.account.domain": "nt authority", "object.account.id": "synthetic:system@nt authority", "object.account.name": "system", "object.account.session_id": "999", "object.process.cmdline": "C:\\Windows\\system32\\services.exe 652 \"lsass.dmp\" a708b1d9-e27b-48bc-8ea7-c56d3a23f99 -v", "object.process.cwd": "c:\\Users\\IEUser\\Desktop\\", "object.process.fullpath": "c:\\windows\\system32\\services.exe", "object.process.guid": "747f3d96-f416-6081-0000-001033034a00", "object.process.hash.md5": "DB896369FB58241ADF28515E3765C514", "object.process.hash.sha1": "617A0A0BAAB180541DB739C4A6851D784943C317", "object.process.hash.sha256": "A2E369DF26C88015FE1F97C7542D6023B5B1E4830C25F94819507EE5BCB1DFCC", "object.process.id": "7188", "object.process.meta": "Description:Services and Controller app | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "services.exe", "object.process.original_name": "services.exe", "object.process.parent.cmdline": "PPLdump.exe -v lsass lsass.dmp", "object.process.parent.fullpath": "c:\\users\\ieuser\\desktop\\ppldump.exe", "object.process.parent.guid": "747f3d96-f415-6081-0000-001040fe4900", "object.process.parent.id": "6316", "object.process.parent.name": "ppldump.exe", "object.process.parent.path": "c:\\users\\ieuser\\desktop\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "10.0.17763.1075 (WinBuild.160101.0800)", "status": "success", "subject": "account", "subject.account.domain": "nt authority", "subject.account.id": "synthetic:system@nt authority", "subject.account.name": "system", "subject.account.privileges": "System", "subject.account.session_id": "999", "subject.process.fullpath": "c:\\windows\\system32\\csrss.exe", "subject.process.guid": "747f3d96-6e19-6082-0000-0010e5580000", "subject.process.id": "504", "subject.process.name": "csrss.exe"}
