{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"1\",\"Version\":\"5\",\"Level\":\"4\",\"Task\":\"1\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-04-22T22:09:25.3896334Z\"},\"EventRecordID\":\"564589\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"3352\",\"ThreadID\":\"4696\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"MSEDGEWIN10\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2021-04-22 22:09:25.377\"},{\"Name\":\"ProcessGuid\",\"text\":\"{747f3d96-f415-6081-0000-001040fe4900}\"},{\"Name\":\"ProcessId\",\"text\":\"6316\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe\"},{\"Name\":\"FileVersion\",\"text\":\"?\"},{\"Name\":\"Description\",\"text\":\"?\"},{\"Name\":\"Product\",\"text\":\"?\"},{\"Name\":\"Company\",\"text\":\"?\"},{\"Name\":\"OriginalFileName\",\"text\":\"?\"},{\"Name\":\"CommandLine\",\"text\":\"PPLdump.exe -v lsass lsass.dmp\"},{\"Name\":\"CurrentDirectory\",\"text\":\"c:\\\\Users\\\\IEUser\\\\Desktop\\\\\"},{\"Name\":\"User\",\"text\":\"MSEDGEWIN10\\\\IEUser\"},{\"Name\":\"LogonGuid\",\"text\":\"{747f3d96-efc5-6081-0000-00203ace0b00}\"},{\"Name\":\"LogonId\",\"text\":\"0xbce3a\"},{\"Name\":\"TerminalSessionId\",\"text\":\"1\"},{\"Name\":\"IntegrityLevel\",\"text\":\"High\"},{\"Name\":\"Hashes\",\"text\":\"SHA1=F1C0C54AA13037F46F55B721F7E2A2349A30DBCF,MD5=DBCA6A3860A106333FF6BE6306B2B186,SHA256=68612B1C72B8AA498530ACEB929ED44F1837B8BC52D1269E30A834931434FC41,IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74\"},{\"Name\":\"ParentProcessGuid\",\"text\":\"{747f3d96-f040-6081-0000-001046ac1b00}\"},{\"Name\":\"ParentProcessId\",\"text\":\"4864\"},{\"Name\":\"ParentImage\",\"text\":\"C:\\\\Windows\\\\System32\\\\cmd.exe\"},{\"Name\":\"ParentCommandLine\",\"text\":\"\\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\\"\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "datafield6": "747f3d96-efc5-6081-0000-00203ace0b00", "event_src.category": "Other", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_1_Process_creation", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "1", "normalized": true, "object": "process", "object.account.domain": "msedgewin10", "object.account.id": "synthetic:ieuser@msedgewin10", "object.account.name": "ieuser", "object.account.privileges": "High", "object.account.session_id": "773690", "object.process.cmdline": "PPLdump.exe -v lsass lsass.dmp", "object.process.cwd": "c:\\Users\\IEUser\\Desktop\\", "object.process.fullpath": "c:\\users\\ieuser\\desktop\\ppldump.exe", "object.process.guid": "747f3d96-f415-6081-0000-001040fe4900", "object.process.hash.imphash": "C547F2E66061A8DFFB6F5A3FF63C0A74", "object.process.hash.md5": "DBCA6A3860A106333FF6BE6306B2B186", "object.process.hash.sha1": "F1C0C54AA13037F46F55B721F7E2A2349A30DBCF", "object.process.hash.sha256": "68612B1C72B8AA498530ACEB929ED44F1837B8BC52D1269E30A834931434FC41", "object.process.id": "6316", "object.process.meta": "Description:? | Product:? | Company:?", "object.process.name": "ppldump.exe", "object.process.original_name": "?", "object.process.parent.cmdline": "\"C:\\Windows\\system32\\cmd.exe\"", "object.process.parent.fullpath": "c:\\windows\\system32\\cmd.exe", "object.process.parent.guid": "747f3d96-f040-6081-0000-001046ac1b00", "object.process.parent.id": "4864", "object.process.parent.name": "cmd.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\users\\ieuser\\desktop\\", "object.process.version": "?", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-14T18:58:15.650Z", "status": "success", "subject": "account", "subject.account.domain": "msedgewin10", "subject.account.id": "synthetic:ieuser@msedgewin10", "subject.account.name": "ieuser", "subject.account.privileges": "High", "subject.account.session_id": "773690", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-04-22T22:09:25.377Z", "type": "raw", "uuid": "f8ef7fd0-08e8-4da7-9ae8-45057b6ed546"}
{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"10\",\"Version\":\"3\",\"Level\":\"4\",\"Task\":\"10\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-04-22T22:09:25.4177398Z\"},\"EventRecordID\":\"564590\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"3352\",\"ThreadID\":\"4696\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"MSEDGEWIN10\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2021-04-22 22:09:25.417\"},{\"Name\":\"SourceProcessGUID\",\"text\":\"{747f3d96-f415-6081-0000-001040fe4900}\"},{\"Name\":\"SourceProcessId\",\"text\":\"6316\"},{\"Name\":\"SourceThreadId\",\"text\":\"2544\"},{\"Name\":\"SourceImage\",\"text\":\"c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe\"},{\"Name\":\"TargetProcessGUID\",\"text\":\"{747f3d96-6e19-6082-0000-001070650000}\"},{\"Name\":\"TargetProcessId\",\"text\":\"652\"},{\"Name\":\"TargetImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\lsass.exe\"},{\"Name\":\"GrantedAccess\",\"text\":\"0x1000\"},{\"Name\":\"CallTrace\",\"text\":\"C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+9fc24|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+2126e|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+211e|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+12c7|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+35c6|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+45f8|C:\\\\Windows\\\\System32\\\\KERNEL32.DLL+17974|C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+6a271\"}]}}}", "category.generic": "Process", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "2544", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+9fc24|C:\\Windows\\System32\\KERNELBASE.dll+2126e|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+211e|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+12c7|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+35c6|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+45f8|C:\\Windows\\System32\\KERNEL32.DLL+17974|C:\\Windows\\SYSTEM32\\ntdll.dll+6a271", "event_src.category": "Other", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_10_Process_access", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "10", "normalized": true, "object": "process", "object.process.fullpath": "c:\\windows\\system32\\lsass.exe", "object.process.guid": "747f3d96-6e19-6082-0000-001070650000", "object.process.id": "652", "object.process.name": "lsass.exe", "object.process.path": "c:\\windows\\system32\\", "object.property": "GrantedAccess", "object.value": "0x1000", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-14T18:58:15.650Z", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\users\\ieuser\\desktop\\ppldump.exe", "subject.process.guid": "747f3d96-f415-6081-0000-001040fe4900", "subject.process.id": "6316", "subject.process.name": "ppldump.exe", "subject.process.path": "c:\\users\\ieuser\\desktop\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-04-22T22:09:25.417Z", "type": "raw", "uuid": "e484f128-19a2-44f8-955e-336a4ec0c447"}
{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"10\",\"Version\":\"3\",\"Level\":\"4\",\"Task\":\"10\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-04-22T22:09:25.4180671Z\"},\"EventRecordID\":\"564591\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"3352\",\"ThreadID\":\"4696\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"MSEDGEWIN10\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\"},{\"Name\":\"UtcTime\",\"text\":\"2021-04-22 22:09:25.417\"},{\"Name\":\"SourceProcessGUID\",\"text\":\"{747f3d96-f415-6081-0000-001040fe4900}\"},{\"Name\":\"SourceProcessId\",\"text\":\"6316\"},{\"Name\":\"SourceThreadId\",\"text\":\"2544\"},{\"Name\":\"SourceImage\",\"text\":\"c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe\"},{\"Name\":\"TargetProcessGUID\",\"text\":\"{747f3d96-6e19-6082-0000-001070650000}\"},{\"Name\":\"TargetProcessId\",\"text\":\"652\"},{\"Name\":\"TargetImage\",\"text\":\"C:\\\\Windows\\\\system32\\\\lsass.exe\"},{\"Name\":\"GrantedAccess\",\"text\":\"0x1000\"},{\"Name\":\"CallTrace\",\"text\":\"C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+9fc24|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+2126e|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+21a9|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+12c7|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+35c6|c:\\\\Users\\\\IEUser\\\\Desktop\\\\PPLdump.exe+45f8|C:\\\\Windows\\\\System32\\\\KERNEL32.DLL+17974|C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+6a271\"}]}}}", "category.generic": "Process", "category.high": "System Management", "category.low": "Manipulation", "datafield5": "2544", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+9fc24|C:\\Windows\\System32\\KERNELBASE.dll+2126e|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+21a9|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+12c7|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+35c6|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+45f8|C:\\Windows\\System32\\KERNEL32.DLL+17974|C:\\Windows\\SYSTEM32\\ntdll.dll+6a271", "event_src.category": "Other", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_10_Process_access", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "10", "normalized": true, "object": "process", "object.process.fullpath": "c:\\windows\\system32\\lsass.exe", "object.process.guid": "747f3d96-6e19-6082-0000-001070650000", "object.process.id": "652", "object.process.name": "lsass.exe", "object.process.path": "c:\\windows\\system32\\", "object.property": "GrantedAccess", "object.value": "0x1000", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-14T18:58:15.650Z", "status": "success", "subject": "process", "subject.process.fullpath": "c:\\users\\ieuser\\desktop\\ppldump.exe", "subject.process.guid": "747f3d96-f415-6081-0000-001040fe4900", "subject.process.id": "6316", "subject.process.name": "ppldump.exe", "subject.process.path": "c:\\users\\ieuser\\desktop\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-04-22T22:09:25.417Z", "type": "raw", "uuid": "5299519a-d1bc-4a02-9757-bb9a63dfcdf3"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1								{"action": "start", "category.generic": "Attack", "category.high": "Credential Access", "category.low": "OS Credential Dumping", "correlation_name": "PPL_Bypass_via_PPLDump_Tool", "correlation_type": "incident", "datafield5": "2544", "datafield9": "C:\\Windows\\SYSTEM32\\ntdll.dll+9fc24|C:\\Windows\\System32\\KERNELBASE.dll+2126e|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+211e|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+12c7|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+35c6|c:\\Users\\IEUser\\Desktop\\PPLdump.exe+45f8|C:\\Windows\\System32\\KERNEL32.DLL+17974|C:\\Windows\\SYSTEM32\\ntdll.dll+6a271", "event_src.fqdn": "msedgewin10", "event_src.host": "msedgewin10", "event_src.hostname": "msedgewin10", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "high", "incident.aggregation.key": "PPL_Bypass_via_PPLDump_Tool|msedgewin10|PPLdump.exe -v lsass lsass.dmp", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "object": "process", "object.account.domain": "msedgewin10", "object.account.id": "synthetic:ieuser@msedgewin10", "object.account.name": "ieuser", "object.account.session_id": "773690", "object.process.cmdline": "PPLdump.exe -v lsass lsass.dmp", "object.process.cwd": "c:\\Users\\IEUser\\Desktop\\", "object.process.fullpath": "c:\\windows\\system32\\lsass.exe", "object.process.guid": "747f3d96-6e19-6082-0000-001070650000", "object.process.hash.md5": "DBCA6A3860A106333FF6BE6306B2B186", "object.process.hash.sha1": "F1C0C54AA13037F46F55B721F7E2A2349A30DBCF", "object.process.hash.sha256": "68612B1C72B8AA498530ACEB929ED44F1837B8BC52D1269E30A834931434FC41", "object.process.id": "652", "object.process.meta": "Description:? | Product:? | Company:?", "object.process.name": "lsass.exe", "object.process.original_name": "?", "object.process.parent.cmdline": "\"C:\\Windows\\system32\\cmd.exe\"", "object.process.parent.fullpath": "c:\\windows\\system32\\cmd.exe", "object.process.parent.guid": "747f3d96-f040-6081-0000-001046ac1b00", "object.process.parent.id": "4864", "object.process.parent.name": "cmd.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\windows\\system32\\", "object.process.version": "?", "status": "success", "subject": "account", "subject.account.domain": "msedgewin10", "subject.account.id": "synthetic:ieuser@msedgewin10", "subject.account.name": "ieuser", "subject.account.privileges": "High", "subject.account.session_id": "773690", "subject.process.fullpath": "c:\\users\\ieuser\\desktop\\ppldump.exe", "subject.process.guid": "747f3d96-f415-6081-0000-001040fe4900", "subject.process.id": "6316", "subject.process.name": "ppldump.exe"}
