{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"5145\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12811\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-05-17T12:08:40.8961838Z\"},\"EventRecordID\":\"42239824\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"4\",\"ThreadID\":\"2460\"},\"Channel\":\"Security\",\"Computer\":\"Win10x64-133.testlab.esc\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-1129291328-2819992169-918366777-1113\"},{\"Name\":\"SubjectUserName\",\"text\":\"yfomina\"},{\"Name\":\"SubjectDomainName\",\"text\":\"TESTLAB\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x48f85a9\"},{\"Name\":\"ObjectType\",\"text\":\"File\"},{\"Name\":\"IpAddress\",\"text\":\"::1\"},{\"Name\":\"IpPort\",\"text\":\"55676\"},{\"Name\":\"ShareName\",\"text\":\"\\\\\\\\*\\\\IPC$\"},{\"Name\":\"ShareLocalPath\"},{\"Name\":\"RelativeTargetName\",\"text\":\"0029482318be6784\"},{\"Name\":\"AccessMask\",\"text\":\"0x12019f\"},{\"Name\":\"AccessList\",\"text\":\"%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424\"},{\"Name\":\"AccessReason\",\"text\":\"-\"}]}}}", "category.generic": "File System Object", "category.high": "System Management", "category.low": "Manipulation", "datafield6": "0x12019f", "datafield9": "READ_CONTROL|SYNCHRONIZE|ReadData (or ListDirectory)|WriteData (or AddFile)|AppendData (or AddSubdirectory or CreatePipeInstance)|ReadEA|WriteEA|ReadAttributes|WriteAttributes", "dst.fqdn": "win10x64-133.testlab.esc", "dst.host": "win10x64-133.testlab.esc", "dst.hostname": "win10x64-133", "event_src.category": "Operating system", "event_src.fqdn": "win10x64-133.testlab.esc", "event_src.host": "win10x64-133.testlab.esc", "event_src.hostname": "win10x64-133", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_5145_A_network_share_object_was_checked", "importance": "medium", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "5145", "normalized": true, "object": "file_object", "object.fullpath": "\\ipc$\\0029482318be6784", "object.name": "0029482318be6784", "object.path": "\\ipc$\\", "object.storage.fullpath": "\\0029482318be6784", "object.storage.id": "\\\\*\\ipc$", "object.storage.name": "0029482318be6784", "object.storage.path": "\\", "object.type": "file", "recv_ipv4": "127.0.0.1", "recv_time": "2023-05-20T12:03:22.271Z", "src.host": "::1", "src.ip": "::1", "src.port": 55676, "status": "success", "subject": "account", "subject.account.domain": "testlab", "subject.account.id": "S-1-5-21-1129291328-2819992169-918366777-1113", "subject.account.name": "yfomina", "subject.account.privileges": "%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424", "subject.account.session_id": "76514729", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-05-17T12:08:40.896Z", "type": "raw", "uuid": "2ecd866e-b08f-4694-aa9c-365d043b0538"}
{"action": "bind", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"18\",\"Version\":\"1\",\"Level\":\"4\",\"Task\":\"18\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-05-17T12:08:40.8964310Z\"},\"EventRecordID\":\"90395393\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"4200\",\"ThreadID\":\"13908\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"Win10x64-133.testlab.esc\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\",\"text\":\"-\"},{\"Name\":\"EventType\",\"text\":\"ConnectPipe\"},{\"Name\":\"UtcTime\",\"text\":\"2023-05-17 12:08:40.887\"},{\"Name\":\"ProcessGuid\",\"text\":\"{b56fc2d9-ea50-6454-eb03-000000000000}\"},{\"Name\":\"ProcessId\",\"text\":\"4\"},{\"Name\":\"PipeName\",\"text\":\"\\\\0029482318be6784\"},{\"Name\":\"Image\",\"text\":\"System\"},{\"Name\":\"User\",\"text\":\"NT AUTHORITY\\\\SYSTEM\"}]}}}", "event_src.category": "Other", "event_src.fqdn": "win10x64-133.testlab.esc", "event_src.host": "win10x64-133.testlab.esc", "event_src.hostname": "win10x64-133", "event_src.rule": "-", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_18_Pipe_connected", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "18", "normalized": true, "object": "resource", "object.name": "0029482318be6784", "object.type": "pipe", "recv_ipv4": "127.0.0.1", "recv_time": "2023-05-20T12:03:22.271Z", "status": "success", "subject": "process", "subject.account.domain": "nt authority", "subject.account.id": "synthetic:system@nt authority", "subject.account.name": "system", "subject.process.fullpath": "system", "subject.process.guid": "b56fc2d9-ea50-6454-eb03-000000000000", "subject.process.id": "4", "subject.process.name": "system", "subject.process.path": "", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-05-17T12:08:40.887Z", "type": "raw", "uuid": "bf1cf59f-425f-457c-9457-7a8b36129c91"}
{"action": "create", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"17\",\"Version\":\"1\",\"Level\":\"4\",\"Task\":\"17\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-05-17T12:08:40.8784795Z\"},\"EventRecordID\":\"90395390\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"4200\",\"ThreadID\":\"13908\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"Win10x64-133.testlab.esc\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"Name\":\"RuleName\",\"text\":\"-\"},{\"Name\":\"EventType\",\"text\":\"CreatePipe\"},{\"Name\":\"UtcTime\",\"text\":\"2023-05-17 12:08:40.869\"},{\"Name\":\"ProcessGuid\",\"text\":\"{b56fc2d9-ab37-6464-5711-000000005e00}\"},{\"Name\":\"ProcessId\",\"text\":\"5852\"},{\"Name\":\"PipeName\",\"text\":\"\\\\0029482318be6784\"},{\"Name\":\"Image\",\"text\":\"C:\\\\Users\\\\yfomina\\\\Downloads\\\\installer.exe\"},{\"Name\":\"User\",\"text\":\"TESTLAB\\\\yfomina\"}]}}}", "event_src.category": "Other", "event_src.fqdn": "win10x64-133.testlab.esc", "event_src.host": "win10x64-133.testlab.esc", "event_src.hostname": "win10x64-133", "event_src.rule": "-", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_Sysmon_17_Pipe_created", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "17", "normalized": true, "object": "resource", "object.name": "0029482318be6784", "object.type": "pipe", "recv_ipv4": "127.0.0.1", "recv_time": "2023-05-20T12:03:22.271Z", "status": "success", "subject": "process", "subject.account.domain": "testlab", "subject.account.id": "synthetic:yfomina@testlab", "subject.account.name": "yfomina", "subject.process.fullpath": "c:\\users\\yfomina\\downloads\\installer.exe", "subject.process.guid": "b56fc2d9-ab37-6464-5711-000000005e00", "subject.process.id": "5852", "subject.process.name": "installer.exe", "subject.process.path": "c:\\users\\yfomina\\downloads\\", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2023-05-17T12:08:40.869Z", "type": "raw", "uuid": "5bbddf39-aba6-4054-9c85-6125dfca64dc"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 								{"action": "escalate", "alert.context": "yfomina -> system", "alert.key": "c:\\users\\yfomina\\downloads\\installer.exe", "category.generic": "Attack", "category.high": "Privilege Escalation", "category.low": "Token Impersonation/Theft", "correlation_name": "Named_Pipe_Impersonation_PrivEsc", "correlation_type": "incident", "event_src.category": "Other", "event_src.host": "win10x64-133.testlab.esc", "event_src.hostname": "win10x64-133", "event_src.rule": "-", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "importance": "high", "object": "session", "object.account.domain": "nt authority", "object.account.id": "synthetic:system@nt authority", "object.account.name": "system", "object.storage.fullpath": "\\0029482318be6784", "object.storage.id": "\\\\*\\ipc$", "object.storage.name": "0029482318be6784", "object.storage.path": "\\", "reason": "Named Pipe Impersonation (RPCSS variant)", "status": "success", "subject": "account", "subject.account.domain": "testlab", "subject.account.id": "synthetic:yfomina@testlab", "subject.account.name": "yfomina", "subject.process.fullpath": "c:\\users\\yfomina\\downloads\\installer.exe", "subject.process.guid": "b56fc2d9-ab37-6464-5711-000000005e00", "subject.process.id": "5852", "subject.process.name": "installer.exe", "subject.process.path": "c:\\users\\yfomina\\downloads\\"}
