{"action": "modify", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4742\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"13825\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-12-12T17:57:52.4994283Z\"},\"EventRecordID\":\"2982098\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"624\",\"ThreadID\":\"2456\"},\"Channel\":\"Security\",\"Computer\":\"dc012.threebeesco.com\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"ComputerAccountChange\",\"text\":\"-\"},{\"Name\":\"TargetUserName\",\"text\":\"DC012\"},{\"Name\":\"TargetDomainName\",\"text\":\"3B\"},{\"Name\":\"TargetSid\",\"text\":\"S-1-5-21-308926384-506822093-3341789130-220105\"},{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-308926384-506822093-3341789130-101606\"},{\"Name\":\"SubjectUserName\",\"text\":\"lgrove\"},{\"Name\":\"SubjectDomainName\",\"text\":\"3B\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x738cf9\"},{\"Name\":\"PrivilegeList\",\"text\":\"-\"},{\"Name\":\"SamAccountName\",\"text\":\"DC012\"},{\"Name\":\"DisplayName\",\"text\":\"-\"},{\"Name\":\"UserPrincipalName\",\"text\":\"-\"},{\"Name\":\"HomeDirectory\",\"text\":\"-\"},{\"Name\":\"HomePath\",\"text\":\"-\"},{\"Name\":\"ScriptPath\",\"text\":\"-\"},{\"Name\":\"ProfilePath\",\"text\":\"-\"},{\"Name\":\"UserWorkstations\",\"text\":\"-\"},{\"Name\":\"PasswordLastSet\",\"text\":\"-\"},{\"Name\":\"AccountExpires\",\"text\":\"-\"},{\"Name\":\"PrimaryGroupId\",\"text\":\"-\"},{\"Name\":\"AllowedToDelegateTo\",\"text\":\"-\"},{\"Name\":\"OldUacValue\",\"text\":\"-\"},{\"Name\":\"NewUacValue\",\"text\":\"-\"},{\"Name\":\"UserAccountControl\",\"text\":\"-\"},{\"Name\":\"UserParameters\",\"text\":\"-\"},{\"Name\":\"SidHistory\",\"text\":\"-\"},{\"Name\":\"LogonHours\",\"text\":\"-\"},{\"Name\":\"DnsHostName\",\"text\":\"-\"},{\"Name\":\"ServicePrincipalNames\",\"text\":\"-\"}]}}}", "category.generic": "Account", "category.high": "Users And Rights Management", "category.low": "Manipulation", "datafield2": "-", "event_src.category": "Directory service", "event_src.fqdn": "dc012.threebeesco.com", "event_src.host": "dc012.threebeesco.com", "event_src.hostname": "dc012", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4742_A_computer_account_was_changed", "importance": "low", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4742", "normalized": true, "object": "account", "object.account.domain": "3b", "object.account.id": "S-1-5-21-308926384-506822093-3341789130-220105", "object.account.name": "dc012", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-04T19:34:20.525Z", "status": "success", "subject": "account", "subject.account.domain": "3b", "subject.account.id": "S-1-5-21-308926384-506822093-3341789130-101606", "subject.account.name": "lgrove", "subject.account.session_id": "7572729", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-12-12T17:57:52.499Z", "type": "raw", "uuid": "4bcc4136-497e-47e8-a24c-bb0db1a0079d"}
{"action": "login", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4768\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"14339\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2021-12-12T17:57:52.5732454Z\"},\"EventRecordID\":\"2982095\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"624\",\"ThreadID\":\"2456\"},\"Channel\":\"Security\",\"Computer\":\"dc012.threebeesco.com\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"TargetUserName\",\"text\":\"dc012\"},{\"Name\":\"TargetDomainName\",\"text\":\"threebeesco.com\"},{\"Name\":\"TargetSid\",\"text\":\"S-1-5-21-308926384-506822093-3341789130-220105\"},{\"Name\":\"ServiceName\",\"text\":\"krbtgt\"},{\"Name\":\"ServiceSid\",\"text\":\"S-1-5-21-308926384-506822093-3341789130-502\"},{\"Name\":\"TicketOptions\",\"text\":\"0x40800010\"},{\"Name\":\"Status\",\"text\":\"0x0\"},{\"Name\":\"TicketEncryptionType\",\"text\":\"0x17\"},{\"Name\":\"PreAuthType\",\"text\":\"2\"},{\"Name\":\"IpAddress\",\"text\":\"::ffff:172.16.66.19\"},{\"Name\":\"IpPort\",\"text\":\"50615\"},{\"Name\":\"CertIssuerName\"},{\"Name\":\"CertSerialNumber\"},{\"Name\":\"CertThumbprint\"}]}}}", "category.generic": "Operating System", "category.high": "Access Management", "category.low": "Communication", "datafield2": "Standard password authentication", "datafield4": "No error", "datafield5": "0x17", "datafield6": "RC4-HMAC", "datafield8": "0x40800010", "datafield9": "S-1-5-21-308926384-506822093-3341789130-502", "event_src.category": "AAA", "event_src.fqdn": "dc012.threebeesco.com", "event_src.host": "dc012.threebeesco.com", "event_src.hostname": "dc012", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4768_A_Kerberos_authentication_ticket_was_requested", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "logon_service": "krbtgt", "logon_type": 2, "mime": "application/x-pt-eventlog", "msgid": "4768", "normalized": true, "object": "system", "reason": "0x0", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-04T19:42:21.025Z", "src.host": "172.16.66.19", "src.ip": "172.16.66.19", "src.port": 50615, "status": "success", "subject": "account", "subject.account.domain": "threebeesco.com", "subject.account.id": "S-1-5-21-308926384-506822093-3341789130-220105", "subject.account.name": "dc012", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2021-12-12T17:57:52.573Z", "type": "raw", "uuid": "f90c9558-8be7-4424-947a-d9822a7045ee"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 								{"action": "modify", "alert.context": "172.16.66.19", "alert.key": "lgrove -> dc012$", "category.generic": "Attack", "category.high": "Privilege Escalation", "category.low": "Exploitation for Privilege Escalation", "correlation_name": "sAMAccountName_Spoofing", "correlation_type": "incident", "event_src.category": "Directory service", "event_src.host": "dc012.threebeesco.com", "event_src.hostname": "dc012", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "importance": "high", "incident.aggregation.key": "sAMAccountName_Spoofing|dc012.threebeesco.com|s-1-5-21-308926384-506822093-3341789130-101606", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "high", "logon_service": "krbtgt", "object": "account", "object.account.domain": "3b", "object.account.id": "S-1-5-21-308926384-506822093-3341789130-220105", "object.account.name": "dc012", "src.host": "172.16.66.19", "src.ip": "172.16.66.19", "src.port": 50615, "status": "success", "subject": "account", "subject.account.domain": "3b", "subject.account.id": "S-1-5-21-308926384-506822093-3341789130-101606", "subject.account.name": "lgrove", "subject.account.session_id": "7572729"}
