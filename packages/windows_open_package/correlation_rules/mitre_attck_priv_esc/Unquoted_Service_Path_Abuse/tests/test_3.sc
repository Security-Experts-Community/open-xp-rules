{"_checkpoint": 60843328089, "_meta": {"id": "041a90cf-0606-01ee-9454-005056825a53", "time": "2023-06-08T14:08:57.6580000Z", "assetIds": ["1864e292-4880-0001-0000-000000000007"], "site_alias": "unknown site_id=null", "site_name": "unknown site_id=null", "site_address": "unknown site_id=null", "site_is_deleted": true}, "action": "start", "asset_ids": ["1864e292-4880-0001-0000-000000000007"], "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Sysmon\",\"Guid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\"},\"EventID\":\"1\",\"Version\":\"5\",\"Level\":\"4\",\"Task\":\"1\",\"Opcode\":\"0\",\"Keywords\":\"0x8000000000000000\",\"TimeCreated\":{\"SystemTime\":\"2023-06-08T14:08:57.662941300Z\"},\"EventRecordID\":\"833155\",\"Correlation\":null,\"Execution\":{\"ProcessID\":\"2336\",\"ThreadID\":\"3744\"},\"Channel\":\"Microsoft-Windows-Sysmon/Operational\",\"Computer\":\"wks05.example.com\",\"Security\":{\"UserID\":\"S-1-5-18\"}},\"EventData\":{\"Data\":[{\"text\":\"-\",\"Name\":\"RuleName\"},{\"text\":\"2023-06-08 14:08:57.658\",\"Name\":\"UtcTime\"},{\"text\":\"{20fff121-e0f9-6481-3701-000000003b00}\",\"Name\":\"ProcessGuid\"},{\"text\":\"4556\",\"Name\":\"ProcessId\"},{\"text\":\"C:\\\\ProgramData\\\\Simple Service\\\\simple.exe\",\"Name\":\"Image\"},{\"text\":\"10.0.17763.1697 (WinBuild.160101.0800)\",\"Name\":\"FileVersion\"},{\"text\":\"Windows Command Processor\",\"Name\":\"Description\"},{\"text\":\"Microsoft® Windows® Operating System\",\"Name\":\"Product\"},{\"text\":\"Microsoft Corporation\",\"Name\":\"Company\"},{\"text\":\"Cmd.Exe\",\"Name\":\"OriginalFileName\"},{\"text\":\"\\\"C:\\\\ProgramData\\\\Simple Service\\\\Simple\\\" Service.exe\",\"Name\":\"CommandLine\"},{\"text\":\"C:\\\\Windows\\\\system32\\\\\",\"Name\":\"CurrentDirectory\"},{\"text\":\"NT AUTHORITY\\\\SYSTEM\",\"Name\":\"User\"},{\"text\":\"{20fff121-dbde-6481-e703-000000000000}\",\"Name\":\"LogonGuid\"},{\"text\":\"0x3e7\",\"Name\":\"LogonId\"},{\"text\":\"0\",\"Name\":\"TerminalSessionId\"},{\"text\":\"System\",\"Name\":\"IntegrityLevel\"},{\"text\":\"MD5=911D039E71583A07320B32BDE22F8E22,SHA256=BC866CFCDDA37E24DC2634DC282C7A0E6F55209DA17A8FA105B07414C0E7C527,IMPHASH=272245E2988E1E430500B852C4FB5E18\",\"Name\":\"Hashes\"},{\"text\":\"{20fff121-dbdd-6481-0b00-000000003b00}\",\"Name\":\"ParentProcessGuid\"},{\"text\":\"648\",\"Name\":\"ParentProcessId\"},{\"text\":\"C:\\\\Windows\\\\System32\\\\services.exe\",\"Name\":\"ParentImage\"},{\"text\":\"C:\\\\Windows\\\\system32\\\\services.exe\",\"Name\":\"ParentCommandLine\"},{\"text\":\"NT AUTHORITY\\\\SYSTEM\",\"Name\":\"ParentUser\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "datafield1": "999", "datafield10": "Cmd.Exe", "datafield19": "simple.exe (4556) (file creator: cmd.exe (4916) ← explorer.exe (4244) ← userinit.exe (4228) ← winlogon.exe (632) ← smss.exe (524) ← smss.exe (324)) ← services.exe (648) ← wininit.exe (532) ← smss.exe (420) ← smss.exe (324) ← system (4)", "datafield2": "648", "datafield3": "c:\\windows\\system32\\", "datafield4": "services.exe", "datafield5": "\"C:\\ProgramData\\Simple Service\\Simple\" Service.exe", "datafield6": "20fff121-dbde-6481-e703-000000000000", "datafield7": "999", "datafield8": "20fff121-e0f9-6481-3701-000000003b00", "datafield9": "C:\\Windows\\system32\\services.exe", "event_src.asset": "1864e292-4880-0001-0000-000000000007", "event_src.category": "Other", "event_src.fqdn": "wks05.example.com", "event_src.host": "wks05.example.com", "event_src.hostname": "wks05", "event_src.subsys": "Microsoft-Windows-Sysmon/Operational", "event_src.title": "sysmon", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2916", "historical": false, "id": "PT_Microsoft_Windows_eventlog_Sysmon_1_Process_creation", "importance": "info", "incorrect_time": false, "input_id": "00000000-0000-0000-0000-000000000000", "job_id": "692db8c2-9d54-11eb-a8b3-0242ac130003", "mime": "application/x-pt-eventlog", "msgid": "1", "normalized": true, "object": "process", "object.account.domain": "nt authority", "object.account.id": "S-1-5-18", "object.account.name": "system", "object.account.privileges": "System", "object.account.provider": "local", "object.account.session_id": "999", "object.hash": "BC866CFCDDA37E24DC2634DC282C7A0E6F55209DA17A8FA105B07414C0E7C527", "object.id": "4556", "object.name": "simple.exe", "object.path": "c:\\programdata\\simple service\\", "object.process.chain": "simple.exe (file creator: cmd.exe ← explorer.exe ← userinit.exe ← winlogon.exe ← smss.exe ← smss.exe) ← services.exe ← wininit.exe ← smss.exe ← smss.exe ← system", "object.process.cmdline": "\"C:\\ProgramData\\Simple Service\\Simple\" Service.exe", "object.process.cwd": "C:\\Windows\\system32\\", "object.process.fullpath": "c:\\programdata\\simple service\\simple.exe", "object.process.guid": "20fff121-e0f9-6481-3701-000000003b00", "object.process.hash": "IMPHASH:272245E2988E1E430500B852C4FB5E18 MD5:911D039E71583A07320B32BDE22F8E22 SHA256:BC866CFCDDA37E24DC2634DC282C7A0E6F55209DA17A8FA105B07414C0E7C527", "object.process.hash.imphash": "272245E2988E1E430500B852C4FB5E18", "object.process.hash.md5": "911D039E71583A07320B32BDE22F8E22", "object.process.hash.sha256": "BC866CFCDDA37E24DC2634DC282C7A0E6F55209DA17A8FA105B07414C0E7C527", "object.process.id": "4556", "object.process.meta": "Description:Windows Command Processor | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.process.name": "simple.exe", "object.process.original_name": "Cmd.Exe", "object.process.parent.cmdline": "C:\\Windows\\system32\\services.exe", "object.process.parent.fullpath": "c:\\windows\\system32\\services.exe", "object.process.parent.guid": "20fff121-dbdd-6481-0b00-000000003b00", "object.process.parent.id": "648", "object.process.parent.name": "services.exe", "object.process.parent.path": "c:\\windows\\system32\\", "object.process.path": "c:\\programdata\\simple service\\", "object.process.version": "10.0.17763.1697 (WinBuild.160101.0800)", "object.property": "metadata", "object.value": "Description:Windows Command Processor | Product:Microsoft® Windows® Operating System | Company:Microsoft Corporation", "object.version": "10.0.17763.1697 (WinBuild.160101.0800)", "origin_app_alias": "MP-1", "origin_app_id": "185957ea-0f40-0001-0000-000000000002", "primary_siem_app_alias": "MP-1", "primary_siem_app_id": "185957ea-0f40-0001-0000-000000000002", "recv_asset": "1864e292-4880-0001-0000-000000000007", "recv_host": "wks05", "recv_ipv4": "2.3.4.5", "remote": false, "scope_id": "00000000-0000-0000-0000-000000000005", "siem_alias": "1.2.3.4", "siem_id": "e944c6fa-4174-4bb7-afae-98b42faee6b2", "site_address": "unknown site_id=null", "site_alias": "unknown site_id=null", "site_name": "unknown site_id=null", "status": "success", "subject": "account", "subject.account.domain": "nt authority", "subject.account.id": "S-1-5-18", "subject.account.name": "system", "subject.account.privileges": "System", "subject.account.session_id": "999", "subject.domain": "nt authority", "subject.name": "system", "subject.state": "on behalf of oneself", "tag": "wineventlog", "tenant_id": "00000000-0000-0000-0000-000000000000", "time": "2023-06-08T14:08:57.6580000Z", "uuid": "041a90cf-0606-01ee-9454-005056825a53"}

#случай, когда в пути к сервису несколько пробелов и хакеры используют не первый
expect 1 {"alert.key": "c:\\programdata\\simple service\\simple.exe|\"c:\\programdata\\simple service\\simple\" service.exe", "correlation_name": "Unquoted_Service_Path_Abuse"}
