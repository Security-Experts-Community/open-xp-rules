# Здесь укажи какие нормализованные события (одно или несколько) ты подаёшь на вход правилу корреляции.
# События отделяются друг от друга символом новой строки. Каждое их них должно быть записано в строку.
{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4688\",\"Version\":\"1\",\"Level\":\"0\",\"Task\":\"13312\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-05-11T17:10:10.6080706Z\"},\"EventRecordID\":\"18197\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"4\",\"ThreadID\":\"52\"},\"Channel\":\"Security\",\"Computer\":\"IEWIN7\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-3583694148-1414552638-2922671848-1000\"},{\"Name\":\"SubjectUserName\",\"text\":\"IEUser\"},{\"Name\":\"SubjectDomainName\",\"text\":\"IEWIN7\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x13765\"},{\"Name\":\"NewProcessId\",\"text\":\"0x628\"},{\"Name\":\"NewProcessName\",\"text\":\"C:\\\\Windows\\\\System32\\\\wusa.exe\"},{\"Name\":\"TokenElevationType\",\"text\":\"%%1938\"},{\"Name\":\"ProcessId\",\"text\":\"0x4f0\"},{\"Name\":\"CommandLine\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "event_src.category": "Operating system", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4688_A_new_process_has_been_created", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4688", "normalized": true, "object": "process", "object.account.domain": "iewin7", "object.account.id": "S-1-5-21-3583694148-1414552638-2922671848-1000", "object.account.name": "ieuser", "object.account.session_id": "79717", "object.process.fullpath": "c:\\windows\\system32\\wusa.exe", "object.process.id": "1576", "object.process.name": "wusa.exe", "object.process.parent.id": "1264", "object.process.path": "c:\\windows\\system32\\", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-19T15:44:16.508Z", "status": "success", "subject": "account", "subject.account.domain": "iewin7", "subject.account.id": "S-1-5-21-3583694148-1414552638-2922671848-1000", "subject.account.name": "ieuser", "subject.account.privileges": "TokenElevationTypeLimited", "subject.account.session_id": "79717", "subject.state": "on behalf of oneself", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-05-11T17:10:10.608Z", "type": "raw", "uuid": "3f5255f8-2046-4ccc-8ab0-94241391249d"}
{"action": "start", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"4688\",\"Version\":\"1\",\"Level\":\"0\",\"Task\":\"13312\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-05-11T17:10:10.8893206Z\"},\"EventRecordID\":\"18207\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"4\",\"ThreadID\":\"52\"},\"Channel\":\"Security\",\"Computer\":\"IEWIN7\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-18\"},{\"Name\":\"SubjectUserName\",\"text\":\"IEWIN7$\"},{\"Name\":\"SubjectDomainName\",\"text\":\"WORKGROUP\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x3e7\"},{\"Name\":\"NewProcessId\",\"text\":\"0xc74\"},{\"Name\":\"NewProcessName\",\"text\":\"C:\\\\Windows\\\\System32\\\\cmd.exe\"},{\"Name\":\"TokenElevationType\",\"text\":\"%%1936\"},{\"Name\":\"ProcessId\",\"text\":\"0x4f0\"},{\"Name\":\"CommandLine\"}]}}}", "category.generic": "Process", "category.high": "Availability Management", "category.low": "Control", "event_src.category": "Operating system", "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_4688_A_new_process_has_been_created", "importance": "info", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "4688", "normalized": true, "object": "process", "object.account.domain": "workgroup", "object.account.id": "S-1-5-18", "object.account.name": "iewin7$", "object.account.session_id": "999", "object.process.fullpath": "c:\\windows\\system32\\cmd.exe", "object.process.id": "3188", "object.process.name": "cmd.exe", "object.process.parent.id": "1264", "object.process.path": "c:\\windows\\system32\\", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-19T15:44:56.726Z", "status": "success", "subject": "account", "subject.account.domain": "workgroup", "subject.account.id": "S-1-5-18", "subject.account.name": "iewin7$", "subject.account.privileges": "TokenElevationTypeDefault", "subject.account.session_id": "999", "subject.state": "on behalf of oneself", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-05-11T17:10:10.889Z", "type": "raw", "uuid": "4b969569-cc44-4df3-a0f2-cc9d3aab72d5"}


# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"_rule": "Subrule_CreateChildProcess_with_DifferentTokens", "action": "escalate", "alert.context": "PID_1264_start_process_wusa.exe_with_TokenElevationTypeLimited_then_PID_1264_start_process_cmd.exe_with_TokenElevationTypeDefault", "alert.key": "TokenElevationTypeLimited->TokenElevationTypeDefault", "category.generic": "Attack", "category.high": "Privilege Escalation", "category.low": "Access Token Manipulation", "correlation_name": "Subrule_CreateChildProcess_with_DifferentTokens", "correlation_type": "incident", "count": 1, "event_src.fqdn": "iewin7", "event_src.host": "iewin7", "event_src.hostname": "iewin7", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "correlationengine", "importance": "medium", "incident.aggregation.key": "Subrule_CreateChildProcess_with_DifferentTokens|iewin7|1264", "incident.aggregation.timeout": 7200, "incident.category": "Undefined", "incident.severity": "medium", "normalized": true, "object": "account", "object.account.domain": "workgroup", "object.account.id": "S-1-5-18", "object.account.name": "iewin7$", "object.account.privileges": "TokenElevationTypeDefault", "object.account.session_id": "999", "object.process.fullpath": "c:\\windows\\system32\\cmd.exe", "object.process.id": "3188", "object.process.name": "cmd.exe", "object.process.parent.id": "1264", "object.process.path": "c:\\windows\\system32\\", "origin_app_id": "00000000-0000-0000-0000-000000000005", "primary_siem_app_id": "00000000-0000-0000-0000-000000000005", "status": "success", "subject": "account", "subject.account.domain": "workgroup", "subject.account.id": "S-1-5-18", "subject.account.name": "iewin7$", "subject.account.privileges": "TokenElevationTypeDefault", "subject.account.session_id": "999"}
