{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"5145\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12811\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-01-20T07:02:45.4093218Z\"},\"EventRecordID\":\"32857\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"436\",\"ThreadID\":\"444\"},\"Channel\":\"Security\",\"Computer\":\"WIN-77LTAPHIQ1R.example.corp\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-1587066498-1489273250-1035260531-1106\"},{\"Name\":\"SubjectUserName\",\"text\":\"user01\"},{\"Name\":\"SubjectDomainName\",\"text\":\"EXAMPLE\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x13659d\"},{\"Name\":\"ObjectType\",\"text\":\"File\"},{\"Name\":\"IpAddress\",\"text\":\"10.0.2.17\"},{\"Name\":\"IpPort\",\"text\":\"49420\"},{\"Name\":\"ShareName\",\"text\":\"\\\\\\\\*\\\\IPC$\"},{\"Name\":\"ShareLocalPath\"},{\"Name\":\"RelativeTargetName\",\"text\":\"samr\"},{\"Name\":\"AccessMask\",\"text\":\"0x12019f\"},{\"Name\":\"AccessList\",\"text\":\"%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424\"},{\"Name\":\"AccessReason\",\"text\":\"-\"}]}}}", "category.generic": "File System Object", "category.high": "System Management", "category.low": "Manipulation", "datafield6": "0x12019f", "datafield9": "READ_CONTROL|SYNCHRONIZE|ReadData (or ListDirectory)|WriteData (or AddFile)|AppendData (or AddSubdirectory or CreatePipeInstance)|ReadEA|WriteEA|ReadAttributes|WriteAttributes", "dst.fqdn": "win-77ltaphiq1r.example.corp", "dst.host": "win-77ltaphiq1r.example.corp", "dst.hostname": "win-77ltaphiq1r", "event_src.category": "Operating system", "event_src.fqdn": "win-77ltaphiq1r.example.corp", "event_src.host": "win-77ltaphiq1r.example.corp", "event_src.hostname": "win-77ltaphiq1r", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_5145_A_network_share_object_was_checked", "importance": "medium", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "5145", "normalized": true, "object": "file_object", "object.fullpath": "\\ipc$\\samr", "object.name": "samr", "object.path": "\\ipc$\\", "object.storage.fullpath": "\\samr", "object.storage.id": "\\\\*\\ipc$", "object.storage.name": "samr", "object.storage.path": "\\", "object.type": "file", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-02T18:47:21.735Z", "src.host": "10.0.2.17", "src.ip": "10.0.2.17", "src.port": 49420, "status": "success", "subject": "account", "subject.account.domain": "example", "subject.account.id": "S-1-5-21-1587066498-1489273250-1035260531-1106", "subject.account.name": "user01", "subject.account.privileges": "%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424", "subject.account.session_id": "1271197", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-01-20T07:02:45.409Z", "type": "raw", "uuid": "b4d20c05-8b7f-4fbd-9809-5ae442ebd83b"}
{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"5145\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12811\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-01-20T07:02:45.4249182Z\"},\"EventRecordID\":\"32858\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"436\",\"ThreadID\":\"444\"},\"Channel\":\"Security\",\"Computer\":\"WIN-77LTAPHIQ1R.example.corp\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-1587066498-1489273250-1035260531-1106\"},{\"Name\":\"SubjectUserName\",\"text\":\"user01\"},{\"Name\":\"SubjectDomainName\",\"text\":\"EXAMPLE\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x13659d\"},{\"Name\":\"ObjectType\",\"text\":\"File\"},{\"Name\":\"IpAddress\",\"text\":\"10.0.2.17\"},{\"Name\":\"IpPort\",\"text\":\"49420\"},{\"Name\":\"ShareName\",\"text\":\"\\\\\\\\*\\\\IPC$\"},{\"Name\":\"ShareLocalPath\"},{\"Name\":\"RelativeTargetName\",\"text\":\"lsarpc\"},{\"Name\":\"AccessMask\",\"text\":\"0x12019f\"},{\"Name\":\"AccessList\",\"text\":\"%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424\"},{\"Name\":\"AccessReason\",\"text\":\"-\"}]}}}", "category.generic": "File System Object", "category.high": "System Management", "category.low": "Manipulation", "datafield6": "0x12019f", "datafield9": "READ_CONTROL|SYNCHRONIZE|ReadData (or ListDirectory)|WriteData (or AddFile)|AppendData (or AddSubdirectory or CreatePipeInstance)|ReadEA|WriteEA|ReadAttributes|WriteAttributes", "dst.fqdn": "win-77ltaphiq1r.example.corp", "dst.host": "win-77ltaphiq1r.example.corp", "dst.hostname": "win-77ltaphiq1r", "event_src.category": "Operating system", "event_src.fqdn": "win-77ltaphiq1r.example.corp", "event_src.host": "win-77ltaphiq1r.example.corp", "event_src.hostname": "win-77ltaphiq1r", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_5145_A_network_share_object_was_checked", "importance": "medium", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "5145", "normalized": true, "object": "file_object", "object.fullpath": "\\ipc$\\lsarpc", "object.name": "lsarpc", "object.path": "\\ipc$\\", "object.storage.fullpath": "\\lsarpc", "object.storage.id": "\\\\*\\ipc$", "object.storage.name": "lsarpc", "object.storage.path": "\\", "object.type": "file", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-02T18:47:21.736Z", "src.host": "10.0.2.17", "src.ip": "10.0.2.17", "src.port": 49420, "status": "success", "subject": "account", "subject.account.domain": "example", "subject.account.id": "S-1-5-21-1587066498-1489273250-1035260531-1106", "subject.account.name": "user01", "subject.account.privileges": "%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424", "subject.account.session_id": "1271197", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-01-20T07:02:45.424Z", "type": "raw", "uuid": "a13d15b6-e9f0-4b43-a2f3-5c5fef6fd0f7"}
{"action": "access", "body": "{\"Event\":{\"xmlns\":\"http://schemas.microsoft.com/win/2004/08/events/event\",\"System\":{\"Provider\":{\"Name\":\"Microsoft-Windows-Security-Auditing\",\"Guid\":\"{54849625-5478-4994-a5ba-3e3b0328c30d}\"},\"EventID\":\"5145\",\"Version\":\"0\",\"Level\":\"0\",\"Task\":\"12811\",\"Opcode\":\"0\",\"Keywords\":\"0x8020000000000000\",\"TimeCreated\":{\"SystemTime\":\"2019-01-20T07:02:45.5501125Z\"},\"EventRecordID\":\"32862\",\"Correlation\":\"\",\"Execution\":{\"ProcessID\":\"436\",\"ThreadID\":\"444\"},\"Channel\":\"Security\",\"Computer\":\"WIN-77LTAPHIQ1R.example.corp\",\"Security\":\"\"},\"EventData\":{\"Data\":[{\"Name\":\"SubjectUserSid\",\"text\":\"S-1-5-21-1587066498-1489273250-1035260531-1106\"},{\"Name\":\"SubjectUserName\",\"text\":\"user01\"},{\"Name\":\"SubjectDomainName\",\"text\":\"EXAMPLE\"},{\"Name\":\"SubjectLogonId\",\"text\":\"0x13659d\"},{\"Name\":\"ObjectType\",\"text\":\"File\"},{\"Name\":\"IpAddress\",\"text\":\"10.0.2.17\"},{\"Name\":\"IpPort\",\"text\":\"49420\"},{\"Name\":\"ShareName\",\"text\":\"\\\\\\\\*\\\\IPC$\"},{\"Name\":\"ShareLocalPath\"},{\"Name\":\"RelativeTargetName\",\"text\":\"srvsvc\"},{\"Name\":\"AccessMask\",\"text\":\"0x12019f\"},{\"Name\":\"AccessList\",\"text\":\"%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424\"},{\"Name\":\"AccessReason\",\"text\":\"-\"}]}}}", "category.generic": "File System Object", "category.high": "System Management", "category.low": "Manipulation", "datafield6": "0x12019f", "datafield9": "READ_CONTROL|SYNCHRONIZE|ReadData (or ListDirectory)|WriteData (or AddFile)|AppendData (or AddSubdirectory or CreatePipeInstance)|ReadEA|WriteEA|ReadAttributes|WriteAttributes", "dst.fqdn": "win-77ltaphiq1r.example.corp", "dst.host": "win-77ltaphiq1r.example.corp", "dst.hostname": "win-77ltaphiq1r", "event_src.category": "Operating system", "event_src.fqdn": "win-77ltaphiq1r.example.corp", "event_src.host": "win-77ltaphiq1r.example.corp", "event_src.hostname": "win-77ltaphiq1r", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "generator.type": "logcollector", "generator.version": "N26.0.2936", "id": "PT_Microsoft_Windows_eventlog_5145_A_network_share_object_was_checked", "importance": "medium", "input_id": "00000000-0000-0000-0000-000000000000", "mime": "application/x-pt-eventlog", "msgid": "5145", "normalized": true, "object": "file_object", "object.fullpath": "\\ipc$\\srvsvc", "object.name": "srvsvc", "object.path": "\\ipc$\\", "object.storage.fullpath": "\\srvsvc", "object.storage.id": "\\\\*\\ipc$", "object.storage.name": "srvsvc", "object.storage.path": "\\", "object.type": "file", "recv_ipv4": "127.0.0.1", "recv_time": "2023-06-02T18:47:21.736Z", "src.host": "10.0.2.17", "src.ip": "10.0.2.17", "src.port": 49420, "status": "success", "subject": "account", "subject.account.domain": "example", "subject.account.id": "S-1-5-21-1587066498-1489273250-1035260531-1106", "subject.account.name": "user01", "subject.account.privileges": "%%1538 %%1541 %%4416 %%4417 %%4418 %%4419 %%4420 %%4423 %%4424", "subject.account.session_id": "1271197", "tag": "some_tag", "task_id": "00000000-0000-0000-0000-000000000000", "taxonomy_version": "26.0.215-release-26.0", "time": "2019-01-20T07:02:45.550Z", "type": "raw", "uuid": "d2931e0d-8404-474d-affa-180bf644e712"}

# Тут будет твой тест. В секции expect укажи сколько и каких корреляционных событий ты ожидаешь
expect 1 {"action": "access", "alert.key": "samr, lsarpc, srvsvc", "category.generic": "Attack", "category.high": "Discovery", "category.low": "Account Discovery", "correlation_name": "Bloodhound", "correlation_type": "incident", "datafield6": "0x12019f", "datafield9": "READ_CONTROL|SYNCHRONIZE|ReadData (or ListDirectory)|WriteData (or AddFile)|AppendData (or AddSubdirectory or CreatePipeInstance)|ReadEA|WriteEA|ReadAttributes|WriteAttributes", "dst.fqdn": "win-77ltaphiq1r.example.corp", "dst.host": "win-77ltaphiq1r.example.corp", "dst.hostname": "win-77ltaphiq1r", "event_src.category": "Operating system", "event_src.fqdn": "win-77ltaphiq1r.example.corp", "event_src.host": "win-77ltaphiq1r.example.corp", "event_src.hostname": "win-77ltaphiq1r", "event_src.subsys": "Security", "event_src.title": "windows", "event_src.vendor": "microsoft", "importance": "medium", "incident.category": "Undefined", "incident.severity": "medium", "object": "file_object", "object.fullpath": "\\ipc$\\srvsvc", "object.name": "srvsvc", "object.path": "\\ipc$\\", "object.storage.fullpath": "\\srvsvc", "object.storage.id": "\\\\*\\ipc$", "object.storage.name": "srvsvc", "object.storage.path": "\\", "src.host": "10.0.2.17", "src.ip": "10.0.2.17", "src.port": 49420, "status": "success", "subject": "account", "subject.account.domain": "example", "subject.account.id": "S-1-5-21-1587066498-1489273250-1035260531-1106", "subject.account.name": "user01", "subject.account.session_id": "1271197"}
